

<!DOCTYPE html>


<html lang="en" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>10. Linear Regression &#8212; R for Health Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/10_linear_regression';</script>
    <link rel="canonical" href="https://alicepaul.github.io/r-for-health-data-science/book/10_linear_regression.html" />
    <link rel="shortcut icon" href="../_static/fav.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11. Logistic Regression" href="11_logistic_regression.html" />
    <link rel="prev" title="9. Hypothesis Testing" href="9_hypothesis_tests.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to R</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_intro_to_r.html">1. Intro to R, RStudio, and Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_data_structures.html">2. Data Structures in R</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_data_files.html">3. Working with Data Files in R</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exploratory Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="4_exploratory_analysis.html">4. Intro to Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_data_transformations_summaries.html">5. Data Transformations and Summaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_merging_data.html">6. Merging and Reshaping Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_visualization_ggplot.html">7. Visualization with ggplot2</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Distributions and Hypothesis Testing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="8_distributions.html">8. Probability Distributions and Random Variables in R</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_hypothesis_tests.html">9. Hypothesis Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Regression</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">10. Linear Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_logistic_regression.html">11. Logistic Regression</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extra Topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="12_rmarkdown_reports.html">12. Writing Reports with R Markdown</a></li>

<li class="toctree-l1"><a class="reference internal" href="13_expanding_r_skills.html">13. Expanding your R Skills</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/alicepaul/r-for-health-data-science/master?urlpath=tree/book/10_linear_regression.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/alicepaul/r-for-health-data-science" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/book/10_linear_regression.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>10. Linear Regression</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-basics">Linear Regression Basics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-equation-in-matrix-form">Linear Regression Equation in matrix form</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-assumption">Model Assumption</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-in-r">Linear Regression in R</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-independent-and-response-variables">Plotting the independent and response variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-basic-linear-regression-function-in-r">Using the basic linear regression function in R</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#intepretating-linear-regression-result">Intepretating Linear Regression Result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#with-categorical-variables">With categorical variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-model-assumptions-with-r">Checking Model Assumptions with R</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#normality">Normality</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#homoscedasticity-and-linearity">homoscedasticity and Linearity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#collinearity">collinearity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#leverage">leverage</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interactive-term">Interactive Term</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformation">Transformation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#log-linear-transform-the-outcome">log-linear transform the outcome</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-log-transform-the-predictor">linear-log transform the predictor</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#log-log-transform-the-predictor-and-outcome">log-log transform the predictor and outcome</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-metrics">Evaluation Metrics</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-the-predicted-value">Getting the predicted value</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mae">MAE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mse">MSE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#aic">AIC</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bic">BIC</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">Feature Selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection">forward selection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-selection">backward selection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#both">both</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reorder">reorder()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="linear-regression">
<h1>10. Linear Regression<a class="headerlink" href="#linear-regression" title="Permalink to this heading">#</a></h1>
<p>This chapter will introduce you to <strong>linear regression</strong> analysis using R.</p>
<section id="linear-regression-basics">
<h2>Linear Regression Basics<a class="headerlink" href="#linear-regression-basics" title="Permalink to this heading">#</a></h2>
<section id="linear-regression-equation-in-matrix-form">
<h3>Linear Regression Equation in matrix form<a class="headerlink" href="#linear-regression-equation-in-matrix-form" title="Permalink to this heading">#</a></h3>
<div class="math notranslate nohighlight">
\[ Y = X\beta + \epsilon \]</div>
</section>
<section id="model-assumption">
<h3>Model Assumption<a class="headerlink" href="#model-assumption" title="Permalink to this heading">#</a></h3>
<p>The assumptions of linear regression are important to ensure the validity and reliability of the model. Here are five key assumptions:</p>
<ul class="simple">
<li><p>Linearity: The relationship between the independent variables and the dependent variable is linear. This means that the change in the dependent variable is proportional to the change in the independent variable(s). It is essential to check for linearity by examining scatter plots or performing diagnostic tests.</p></li>
<li><p>Independence: The observations in the dataset are assumed to be independent of each other. There should be no systematic relationship or correlation between the residuals (the differences between the predicted and observed values). Independence can be violated when there is autocorrelation or when observations are clustered or dependent on each other.</p></li>
<li><p>Homoscedasticity: The variance of the residuals is constant across all levels of the independent variables. In other words, the spread or dispersion of the residuals should remain consistent throughout the range of the independent variable(s). Violations of homoscedasticity, called heteroscedasticity, can lead to biased standard errors and incorrect hypothesis tests.</p></li>
<li><p>Normality: The residuals follow a normal distribution. This assumption allows for valid hypothesis testing, confidence interval estimation, and prediction intervals. Departures from normality can affect the accuracy of statistical inferences, especially when dealing with small sample sizes. However, the central limit theorem helps to mitigate minor departures from normality in large samples.</p></li>
<li><p>No multicollinearity: The independent variables should not be highly correlated with each other. High multicollinearity can lead to unstable and unreliable estimates of the coefficients. It becomes challenging to distinguish the individual effects of the independent variables, and the interpretation of the model becomes problematic. Detecting multicollinearity can be done using correlation matrices or variance inflation factor (VIF) calculations.</p></li>
</ul>
<p>We’ll discuss how to check these assumptions with R in the later section.</p>
</section>
</section>
<section id="linear-regression-in-r">
<h2>Linear Regression in R<a class="headerlink" href="#linear-regression-in-r" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">&#39;RforHDSdata&#39;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&#39;broom&#39;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&#39;MASS&#39;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&#39;tidyverse&#39;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&#39;car&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>── <span class=" -Color -Color-Bold">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">dplyr    </span> 1.1.2     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">readr    </span> 2.1.4
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">forcats  </span> 1.0.0     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">stringr  </span> 1.5.0
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">ggplot2  </span> 3.4.2     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tibble   </span> 3.2.1
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">lubridate</span> 1.9.2     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tidyr    </span> 1.3.0
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">purrr    </span> 1.0.1     
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>── <span class=" -Color -Color-Bold">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">filter()</span> masks <span class=" -Color -Color-Blue">stats</span>::filter()
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">lag()</span>    masks <span class=" -Color -Color-Blue">stats</span>::lag()
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">select()</span> masks <span class=" -Color -Color-Blue">MASS</span>::select()
<span class=" -Color -Color-Cyan">ℹ</span> Use the conflicted package (<span class=" -Color -Color-Blue">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading required package: carData
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Attaching package: ‘car’
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following object is masked from ‘package:dplyr’:

    recode
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following object is masked from ‘package:purrr’:

    some
</pre></div>
</div>
</div>
</div>
<section id="eda">
<h3>EDA<a class="headerlink" href="#eda" title="Permalink to this heading">#</a></h3>
<p>Just like we did in Chapter 4, we will first do some EDA and fill in the missing values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">data</span><span class="p">(</span><span class="n">NHANESsample</span><span class="p">)</span>
<span class="nf">dim</span><span class="p">(</span><span class="n">NHANESsample</span><span class="p">)</span>
<span class="nf">names</span><span class="p">(</span><span class="n">NHANESsample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>31265</li><li>21</li></ol>
</div><div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>'ID'</li><li>'AGE'</li><li>'SEX'</li><li>'RACE'</li><li>'EDUCATION'</li><li>'INCOME'</li><li>'SMOKE'</li><li>'YEAR'</li><li>'LEAD'</li><li>'BMI_CAT'</li><li>'LEAD_QUANTILE'</li><li>'HYP'</li><li>'ALC'</li><li>'DBP1'</li><li>'DBP2'</li><li>'DBP3'</li><li>'DBP4'</li><li>'SBP1'</li><li>'SBP2'</li><li>'SBP3'</li><li>'SBP4'</li></ol>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sum</span><span class="p">(</span><span class="nf">complete.cases</span><span class="p">(</span><span class="n">NHANESsample</span><span class="p">))</span>
<span class="nf">apply</span><span class="p">(</span><span class="n">NHANESsample</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="o">/</span><span class="nf">nrow</span><span class="p">(</span><span class="n">NHANESsample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0</div><div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>ID</dt><dd>0</dd><dt>AGE</dt><dd>0</dd><dt>SEX</dt><dd>0</dd><dt>RACE</dt><dd>0</dd><dt>EDUCATION</dt><dd>0.000671677594754518</dd><dt>INCOME</dt><dd>0</dd><dt>SMOKE</dt><dd>0</dd><dt>YEAR</dt><dd>0</dd><dt>LEAD</dt><dd>0</dd><dt>BMI_CAT</dt><dd>0</dd><dt>LEAD_QUANTILE</dt><dd>0</dd><dt>HYP</dt><dd>0</dd><dt>ALC</dt><dd>0.0268671037901807</dd><dt>DBP1</dt><dd>0.0600351831121062</dd><dt>DBP2</dt><dd>0.063905325443787</dd><dt>DBP3</dt><dd>0.070973932512394</dd><dt>DBP4</dt><dd>0.89112426035503</dd><dt>SBP1</dt><dd>0.0600351831121062</dd><dt>SBP2</dt><dd>0.063905325443787</dd><dt>SBP3</dt><dd>0.0709419478650248</dd><dt>SBP4</dt><dd>0.89112426035503</dd></dl>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_df</span> <span class="o">&lt;-</span> <span class="nf">na.omit</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">NHANESsample</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span> <span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">SBP2</span><span class="p">,</span> <span class="n">SBP3</span><span class="p">,</span> <span class="n">SBP4</span><span class="p">,</span> <span class="n">DBP2</span><span class="p">,</span> <span class="n">DBP3</span><span class="p">,</span> <span class="n">DBP4</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_df</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">nhanes_df</span><span class="p">,</span> <span class="n">nhanes_df</span><span class="o">$</span><span class="n">YEAR</span><span class="o">==</span><span class="m">2017</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="n">nhanes_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 15</caption>
<thead>
	<tr><th></th><th scope=col>ID</th><th scope=col>AGE</th><th scope=col>SEX</th><th scope=col>RACE</th><th scope=col>EDUCATION</th><th scope=col>INCOME</th><th scope=col>SMOKE</th><th scope=col>YEAR</th><th scope=col>LEAD</th><th scope=col>BMI_CAT</th><th scope=col>LEAD_QUANTILE</th><th scope=col>HYP</th><th scope=col>ALC</th><th scope=col>DBP1</th><th scope=col>SBP1</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>27663</th><td>93711</td><td>56</td><td><span style=white-space:pre-wrap>Male  </span></td><td><span style=white-space:pre-wrap>Other Race        </span></td><td>MoreThanHS</td><td>5.00</td><td>NeverSmoke</td><td>2017</td><td>2.15</td><td>BMI&lt;=25</td><td>Q3</td><td>0</td><td>Yes</td><td>68</td><td>108</td></tr>
	<tr><th scope=row>27664</th><td>93713</td><td>67</td><td><span style=white-space:pre-wrap>Male  </span></td><td>Non-Hispanic White</td><td><span style=white-space:pre-wrap>HS        </span></td><td>2.65</td><td>StillSmoke</td><td>2017</td><td>3.71</td><td>BMI&lt;=25</td><td>Q4</td><td>0</td><td>Yes</td><td>70</td><td>104</td></tr>
	<tr><th scope=row>27667</th><td>93716</td><td>61</td><td><span style=white-space:pre-wrap>Male  </span></td><td><span style=white-space:pre-wrap>Other Race        </span></td><td>MoreThanHS</td><td>5.00</td><td>QuitSmoke </td><td>2017</td><td>1.99</td><td>BMI&gt;=30</td><td>Q3</td><td>0</td><td>Yes</td><td>72</td><td>120</td></tr>
	<tr><th scope=row>27668</th><td>93717</td><td>22</td><td><span style=white-space:pre-wrap>Male  </span></td><td>Non-Hispanic White</td><td><span style=white-space:pre-wrap>HS        </span></td><td>1.49</td><td>StillSmoke</td><td>2017</td><td>1.93</td><td>BMI&lt;=25</td><td>Q3</td><td>0</td><td>Yes</td><td>62</td><td>116</td></tr>
	<tr><th scope=row>27670</th><td>93721</td><td>60</td><td>Female</td><td><span style=white-space:pre-wrap>Mexican American  </span></td><td>LessThanHS</td><td>3.04</td><td>NeverSmoke</td><td>2017</td><td>0.75</td><td>BMI&gt;=30</td><td>Q1</td><td>1</td><td>Yes</td><td>68</td><td>132</td></tr>
	<tr><th scope=row>27671</th><td>93722</td><td>60</td><td>Female</td><td>Non-Hispanic White</td><td>MoreThanHS</td><td>2.07</td><td>NeverSmoke</td><td>2017</td><td>0.98</td><td>BMI&lt;=25</td><td>Q2</td><td>0</td><td>Yes</td><td>68</td><td>116</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="plotting-the-independent-and-response-variables">
<h3>Plotting the independent and response variables<a class="headerlink" href="#plotting-the-independent-and-response-variables" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">SBP1</span> <span class="o">&lt;-</span> <span class="n">nhanes_df</span><span class="o">$</span><span class="n">SBP1</span>
<span class="n">LEAD</span> <span class="o">&lt;-</span> <span class="n">nhanes_df</span><span class="o">$</span><span class="n">LEAD</span>

<span class="nf">plot</span><span class="p">(</span><span class="n">SBP1</span><span class="o">~</span><span class="n">LEAD</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;systolic blood pressure&quot;</span><span class="p">),</span><span class="n">xlab</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;lead level&quot;</span><span class="p">),</span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/aeb1a9c8ec9ce03e71a831e15c4a409c6df359401400b702574d862b60fd2f59.png" src="../_images/aeb1a9c8ec9ce03e71a831e15c4a409c6df359401400b702574d862b60fd2f59.png" />
</div>
</div>
<p>From the scatterplot, we could see a roughly linear relationship between SBP1 and LEAD</p>
</section>
<section id="using-the-basic-linear-regression-function-in-r">
<h3>Using the basic linear regression function in R<a class="headerlink" href="#using-the-basic-linear-regression-function-in-r" title="Permalink to this heading">#</a></h3>
<p>Now fit a regression line to explain the association between SBP1 and LEAD.</p>
<p>The function in R is lm(formula = y ~ x, data)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="n">SBP1</span><span class="o">~</span><span class="n">LEAD</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = SBP1 ~ LEAD, data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-62.656 -12.707  -2.489   9.704  96.430 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 121.6722     0.5059 240.530  &lt; 2e-16 ***
LEAD          2.4073     0.2933   8.209 3.49e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 18.14 on 2582 degrees of freedom
Multiple R-squared:  0.02543,	Adjusted R-squared:  0.02506 
F-statistic: 67.38 on 1 and 2582 DF,  p-value: 3.487e-16
</pre></div>
</div>
</div>
</div>
<p>We could also use multiple independent variables in the same linear model</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">AGE</span> <span class="o">&lt;-</span> <span class="n">nhanes_df</span><span class="o">$</span><span class="n">AGE</span>

<span class="n">model1</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="n">SBP1</span><span class="o">~</span><span class="n">LEAD</span> <span class="o">+</span> <span class="n">AGE</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = SBP1 ~ LEAD + AGE, data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-43.636 -10.832  -1.512   8.673  95.614 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 101.4223     0.9743 104.093   &lt;2e-16 ***
LEAD          0.5317     0.2777   1.914   0.0557 .  
AGE           0.4666     0.0198  23.561   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 16.46 on 2581 degrees of freedom
Multiple R-squared:  0.1979,	Adjusted R-squared:  0.1973 
F-statistic: 318.5 on 2 and 2581 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
<p>Next plot the estimtated regression line over the scatterplot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">SBP1</span><span class="o">~</span><span class="n">LEAD</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;systolic blood pressure&quot;</span><span class="p">),</span><span class="n">xlab</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;lead level&quot;</span><span class="p">),</span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/224ce9fa4015e64b49fbc35445f42d422cb10798039057e9c442258a23d737b1.png" src="../_images/224ce9fa4015e64b49fbc35445f42d422cb10798039057e9c442258a23d737b1.png" />
</div>
</div>
</section>
<section id="intepretating-linear-regression-result">
<h3>Intepretating Linear Regression Result<a class="headerlink" href="#intepretating-linear-regression-result" title="Permalink to this heading">#</a></h3>
<p>We can also extract the regression coefficients from the lm() using the following commands, it shows the estimate, standard error, statistic, and p-value of each coefficient in a clean table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tidy</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 3 × 5</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>estimate</th><th scope=col>std.error</th><th scope=col>statistic</th><th scope=col>p.value</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>(Intercept)</td><td>101.4223022</td><td>0.97434128</td><td>104.093200</td><td> 0.000000e+00</td></tr>
	<tr><td>LEAD       </td><td>  0.5316624</td><td>0.27774430</td><td>  1.914215</td><td> 5.570310e-02</td></tr>
	<tr><td>AGE        </td><td>  0.4665639</td><td>0.01980224</td><td> 23.561165</td><td>2.439947e-111</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="with-categorical-variables">
<h3>With categorical variables<a class="headerlink" href="#with-categorical-variables" title="Permalink to this heading">#</a></h3>
<p>We can also examine the relationship between a new feature we created in chapter 4, EVER_SMOKE-a categorical variable represented by numbers, and body height using the function factor().</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">EVER_SMOKE</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">SMOKE</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;QuitSmoke&quot;</span><span class="p">,</span> <span class="s">&quot;StillSmoke&quot;</span><span class="p">),</span> <span class="s">&quot;Yes&quot;</span><span class="p">,</span> <span class="s">&quot;No&quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">EVER_SMOKE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  No  Yes 
1411 1173 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">EVER_SMOKE</span> <span class="o">&lt;-</span> <span class="n">nhanes_df</span><span class="o">$</span><span class="n">EVER_SMOKE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model2</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="n">SBP1</span><span class="o">~</span><span class="nf">factor</span><span class="p">(</span><span class="n">EVER_SMOKE</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = SBP1 ~ factor(EVER_SMOKE), data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-37.436 -13.436  -2.032   9.968  97.968 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           123.4359     0.4881 252.905  &lt; 2e-16 ***
factor(EVER_SMOKE)Yes   2.5965     0.7244   3.584 0.000344 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 18.33 on 2582 degrees of freedom
Multiple R-squared:  0.004951,	Adjusted R-squared:  0.004566 
F-statistic: 12.85 on 1 and 2582 DF,  p-value: 0.0003442
</pre></div>
</div>
</div>
</div>
<p>In order to consider LEAD, EVER_SMOKE, and SBP1, we can start by creating a scatterplot of height versus upper leg lenth, stratified by body measures component status code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">colvec</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)</span> <span class="c1"># here define values to define color in plot below </span>
<span class="nf">plot</span><span class="p">(</span><span class="n">LEAD</span><span class="p">,</span> <span class="n">SBP1</span><span class="p">,</span> <span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">colvec</span><span class="p">[</span><span class="nf">factor</span><span class="p">(</span><span class="n">EVER_SMOKE</span><span class="p">)],</span> <span class="n">xlab</span><span class="o">=</span><span class="s">&quot;lead level&quot;</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;systolic blood pressure&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/181c7bb2f291bc18d2904a1eaa6fba91cef74a98bd02b7ee5f1b12abbe8e827e.png" src="../_images/181c7bb2f291bc18d2904a1eaa6fba91cef74a98bd02b7ee5f1b12abbe8e827e.png" />
</div>
</div>
<p>Now lets fit a model to predict SBP1 based on LEAD and EVER_SMOKE.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model3</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span> <span class="n">SBP1</span><span class="o">~</span><span class="nf">factor</span><span class="p">(</span><span class="n">EVER_SMOKE</span><span class="p">)</span> <span class="o">+</span> <span class="n">LEAD</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = SBP1 ~ factor(EVER_SMOKE) + LEAD, data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-59.639 -12.449  -2.506   9.673  95.595 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           120.9998     0.5755 210.242  &lt; 2e-16 ***
factor(EVER_SMOKE)Yes   1.7681     0.7241   2.442   0.0147 *  
LEAD                    2.3008     0.2962   7.767 1.15e-14 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 18.13 on 2581 degrees of freedom
Multiple R-squared:  0.02768,	Adjusted R-squared:  0.02693 
F-statistic: 36.74 on 2 and 2581 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
<p>Last, let’s look at estimating a 95% confidence interval for the coefficient for upper leg length. We can do it by using the function confint()</p>
<p>Note that the function confint() will give confidence interval to all coefficients, including categorical variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">ci</span> <span class="o">&lt;-</span> <span class="nf">confint</span><span class="p">(</span><span class="n">model3</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="m">0.95</span><span class="p">)</span>
<span class="n">ci</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A matrix: 3 × 2 of type dbl</caption>
<thead>
	<tr><th></th><th scope=col>2.5 %</th><th scope=col>97.5 %</th></tr>
</thead>
<tbody>
	<tr><th scope=row>(Intercept)</th><td>119.8712145</td><td>122.128293</td></tr>
	<tr><th scope=row>factor(EVER_SMOKE)Yes</th><td>  0.3481456</td><td>  3.187983</td></tr>
	<tr><th scope=row>LEAD</th><td>  1.7199240</td><td>  2.881581</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="checking-model-assumptions-with-r">
<h3>Checking Model Assumptions with R<a class="headerlink" href="#checking-model-assumptions-with-r" title="Permalink to this heading">#</a></h3>
<p>R has some built-in plots available for a linear regression model. We plot these below. The four plots include (a) Residuals vs Fitted, (b) QQ-plot, (c) Standardized residuals (sqrt) vs Fitted, and (d) Standardized residuals vs leverage. In the last plot, you may observe that there is a dashed line. Any points outside of these lines have a Cook’s distance of greater than 0.5. Additionally, points with labels correspond to the points with the largest residuals. So this last plot tries to summarize the outliers, leverage, and influential
points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span> <span class="c1"># for formatting</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">model3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0037291c4bf750226edd367716bd3a4b4cbcc4d8a5555d0e6026e8fc444a7fed.png" src="../_images/0037291c4bf750226edd367716bd3a4b4cbcc4d8a5555d0e6026e8fc444a7fed.png" />
</div>
</div>
<section id="normality">
<h4>Normality<a class="headerlink" href="#normality" title="Permalink to this heading">#</a></h4>
<p>As both the histogram and qq plot shown, the residuals are positive-skewed, and thus Normality is not satisfied, we will introduce how we might transform this dataset to satisfy this assumption later in this chapter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span> <span class="c1"># for formatting</span>
<span class="nf">hist</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">model3</span><span class="p">))</span> <span class="c1"># hist() is used to plot histogram, resid() is used to get residuals of the model</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">model3</span><span class="p">))</span> <span class="c1"># qqnorm() is used to plot qq plot</span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">model3</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span> <span class="c1"># qqline is used to draw the normal qq line as reference</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a219c4fb72a86823f44f4714ee4e0c77bbc6f72d9aeac464dd1bf0491a0d5747.png" src="../_images/a219c4fb72a86823f44f4714ee4e0c77bbc6f72d9aeac464dd1bf0491a0d5747.png" />
</div>
</div>
<p>We could also check normality without using the function resid(). We could calculate the standardized residual using the function rstandard(), and then use the standardized residual to check.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span> 
<span class="nf">hist</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model3</span><span class="p">))</span> 
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model3</span><span class="p">))</span> 
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model3</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ab85ad2c44f886cac71dbe68183201f793074c85175b80f0833b60d0ddbfa01a.png" src="../_images/ab85ad2c44f886cac71dbe68183201f793074c85175b80f0833b60d0ddbfa01a.png" />
</div>
</div>
</section>
<section id="homoscedasticity-and-linearity">
<h4>homoscedasticity and Linearity<a class="headerlink" href="#homoscedasticity-and-linearity" title="Permalink to this heading">#</a></h4>
<p>The fitted vs. residual plot is spread roughly evenly around 0 and has no discerning pattern, and thus fit the linearity assumption. However, the residual vs. fitted value graph shows a tunnel shape, indicating a shrinking variance of residuals, and is thus, violating homoscedasticity assumption.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="nf">fitted</span><span class="p">(</span><span class="n">model3</span><span class="p">),</span> <span class="nf">resid</span><span class="p">(</span><span class="n">model3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f3233bad99777a6897adffcc76c331159e420470ad6471b6b0496062ffc5ee51.png" src="../_images/f3233bad99777a6897adffcc76c331159e420470ad6471b6b0496062ffc5ee51.png" />
</div>
</div>
</section>
<section id="collinearity">
<h4>collinearity<a class="headerlink" href="#collinearity" title="Permalink to this heading">#</a></h4>
<p>VIF = 1 → complete absence of collinearity</p>
<p>VIF ≥ 5 or 10 → problematic amount of collinearity</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">vif</span><span class="p">(</span><span class="n">model3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>factor(EVER_SMOKE)</dt><dd>1.02217733408279</dd><dt>LEAD</dt><dd>1.02217733408279</dd></dl>
</div></div>
</div>
</section>
<section id="leverage">
<h4>leverage<a class="headerlink" href="#leverage" title="Permalink to this heading">#</a></h4>
<p>Leverage values measure how much an individual observation’s predictor values differ from the average predictor values in the dataset. High leverage values indicate that an observation has extreme predictor values compared to the rest of the data.</p>
<p>Leverage values range from 0 to 1, with higher values indicating greater influence. Observations with high leverage have the potential to significantly impact the estimated regression coefficients and the overall fit of the model. Therefore, examining leverage values helps identify observations that may be influential or outliers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="nf">hatvalues</span><span class="p">(</span><span class="n">model3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>27663</dt><dd>0.00102665858343094</dd><dt>27664</dt><dd>0.00225417987631527</dd><dt>27667</dt><dd>0.000939603393907319</dd><dt>27668</dt><dd>0.000922265051483185</dd><dt>27670</dt><dd>0.000734185722753415</dd><dt>27671</dt><dd>0.000710376627358568</dd></dl>
</div></div>
</div>
<p>The influence.measures() function provides a set of measures that quantify the influence of each observation on a linear regression model. These measures include Cook’s distance, standardized residuals, and studentized residuals, among others.</p>
<ul class="simple">
<li><p>Cook’s distance measures the influence of an observation on the overall model fit. Large values of Cook’s distance suggest that removing that observation would have a substantial effect on the estimated coefficients.</p></li>
<li><p>Standardized residuals measure the difference between the observed and predicted values, scaled by the standard deviation of the residuals. Outlying observations often exhibit large standardized residuals.</p></li>
<li><p>Studentized residuals are similar to standardized residuals, but they are scaled by the estimated standard deviation of the residuals, accounting for the influence of each observation on its own predicted value.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">inflm</span> <span class="o">&lt;-</span> <span class="nf">influence.measures</span><span class="p">(</span><span class="n">model3</span><span class="p">)</span>

<span class="n">inflm.df</span> <span class="o">&lt;-</span>
  <span class="nf">as.data.frame</span><span class="p">(</span><span class="n">inflm</span><span class="p">[[</span><span class="s">&quot;infmat&quot;</span><span class="p">]])</span> <span class="o">%&gt;%</span>
  <span class="n">tibble</span><span class="o">::</span><span class="nf">remove_rownames</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="n">dplyr</span><span class="o">::</span><span class="nf">mutate</span><span class="p">(</span><span class="n">inf</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="nf">row_number</span><span class="p">()</span> <span class="o">%in%</span> <span class="nf">unname</span><span class="p">(</span><span class="nf">which</span><span class="p">(</span>
    <span class="nf">apply</span><span class="p">(</span><span class="n">inflm</span><span class="o">$</span><span class="n">is.inf</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">any</span><span class="p">)</span>
  <span class="p">)),</span> <span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">))</span> <span class="c1"># converting infl to data frame format for easier access</span>

<span class="nf">head</span><span class="p">(</span><span class="n">inflm.df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 8</caption>
<thead>
	<tr><th></th><th scope=col>dfb.1_</th><th scope=col>dfb.f(EV</th><th scope=col>dfb.LEAD</th><th scope=col>dffit</th><th scope=col>cov.r</th><th scope=col>cook.d</th><th scope=col>hat</th><th scope=col>inf</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>-0.012491996</td><td> 0.020185561</td><td>-0.0176717649</td><td>-0.03175553</td><td>1.001050</td><td>3.361404e-04</td><td>0.0010266586</td><td></td></tr>
	<tr><th scope=row>2</th><td> 0.030808633</td><td>-0.023898019</td><td>-0.0565346545</td><td>-0.07169468</td><td>1.000775</td><td>1.712530e-03</td><td>0.0022541799</td><td></td></tr>
	<tr><th scope=row>3</th><td> 0.002062675</td><td>-0.008098088</td><td>-0.0037850628</td><td>-0.01243269</td><td>1.001913</td><td>5.154060e-05</td><td>0.0009396034</td><td></td></tr>
	<tr><th scope=row>4</th><td> 0.002816455</td><td>-0.012444929</td><td>-0.0051682691</td><td>-0.01879319</td><td>1.001642</td><td>1.177561e-04</td><td>0.0009222651</td><td></td></tr>
	<tr><th scope=row>5</th><td> 0.012835827</td><td>-0.008702177</td><td>-0.0025837042</td><td> 0.01387216</td><td>1.001594</td><td>6.416395e-05</td><td>0.0007341857</td><td></td></tr>
	<tr><th scope=row>6</th><td>-0.009219362</td><td> 0.007028075</td><td> 0.0005158298</td><td>-0.01067270</td><td>1.001688</td><td>3.798123e-05</td><td>0.0007103766</td><td></td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
</section>
<section id="interactive-term">
<h3>Interactive Term<a class="headerlink" href="#interactive-term" title="Permalink to this heading">#</a></h3>
<p>To capture the interaction between two terms, suppose AGE and EVER_SMOKE, we could use the function shown below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model5</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">SBP1</span> <span class="o">~</span> <span class="nf">factor</span><span class="p">(</span><span class="n">EVER_SMOKE</span><span class="p">)</span> <span class="o">+</span> <span class="n">LEAD</span> <span class="o">+</span> <span class="n">EVER_SMOKE</span><span class="o">:</span><span class="n">LEAD</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = SBP1 ~ factor(EVER_SMOKE) + LEAD + EVER_SMOKE:LEAD, 
    data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-61.939 -12.433  -2.584   9.652  95.717 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           120.8835     0.6505 185.830  &lt; 2e-16 ***
factor(EVER_SMOKE)Yes   2.0512     1.0341   1.983   0.0474 *  
LEAD                    2.4105     0.4119   5.852 5.47e-09 ***
LEAD:EVER_SMOKEYes     -0.2274     0.5929  -0.384   0.7014    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 18.13 on 2580 degrees of freedom
Multiple R-squared:  0.02774,	Adjusted R-squared:  0.0266 
F-statistic: 24.53 on 3 and 2580 DF,  p-value: 1.195e-15
</pre></div>
</div>
</div>
</div>
</section>
<section id="transformation">
<h3>Transformation<a class="headerlink" href="#transformation" title="Permalink to this heading">#</a></h3>
<p>Sometimes when the original data doesn’t fit the linear regression assumptions, we could transform either the predictor or the outcome.</p>
<section id="log-linear-transform-the-outcome">
<h4>log-linear transform the outcome<a class="headerlink" href="#log-linear-transform-the-outcome" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model6</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">SBP1</span><span class="p">)</span> <span class="o">~</span> <span class="n">LEAD</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">nhanes_df</span><span class="p">)</span> 
<span class="nf">summary</span><span class="p">(</span><span class="n">model6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = log(SBP1) ~ LEAD, data = nhanes_df)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.48184 -0.09856 -0.01034  0.08488  0.57387 

Coefficients:
            Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept) 4.792368   0.003882 1234.544  &lt; 2e-16 ***
LEAD        0.018536   0.002250    8.236 2.78e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1392 on 2582 degrees of freedom
Multiple R-squared:  0.0256,	Adjusted R-squared:  0.02522 
F-statistic: 67.84 on 1 and 2582 DF,  p-value: 2.784e-16
</pre></div>
</div>
</div>
</div>
<p>Before transformation, the linear model is stored in model3, and the distribution is shown below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span> 
<span class="nf">hist</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model3</span><span class="p">))</span> 
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model3</span><span class="p">))</span> 
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model3</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ab85ad2c44f886cac71dbe68183201f793074c85175b80f0833b60d0ddbfa01a.png" src="../_images/ab85ad2c44f886cac71dbe68183201f793074c85175b80f0833b60d0ddbfa01a.png" />
</div>
</div>
<p>After the transformation, the new linear model is stored in model6, and we could see that the distribution is less skewed than before</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span> 
<span class="nf">hist</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model6</span><span class="p">))</span> 
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model6</span><span class="p">))</span> 
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model6</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3c47fcc60b2514e26baf35fe34e7a4b9deac0b1d56db85d8630de2c44d8a80f1.png" src="../_images/3c47fcc60b2514e26baf35fe34e7a4b9deac0b1d56db85d8630de2c44d8a80f1.png" />
</div>
</div>
</section>
<section id="linear-log-transform-the-predictor">
<h4>linear-log transform the predictor<a class="headerlink" href="#linear-log-transform-the-predictor" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model7</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">SBP1</span> <span class="o">~</span> <span class="nf">I</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">LEAD</span><span class="p">)),</span> <span class="n">data</span><span class="o">=</span><span class="n">nhanes_df</span><span class="p">)</span> 
<span class="nf">summary</span><span class="p">(</span><span class="n">model7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = SBP1 ~ I(log(LEAD)), data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-41.674 -12.440  -2.441   9.321  94.924 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  125.1023     0.3524  355.02   &lt;2e-16 ***
I(log(LEAD))   6.3417     0.4897   12.95   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 17.81 on 2582 degrees of freedom
Multiple R-squared:  0.06099,	Adjusted R-squared:  0.06063 
F-statistic: 167.7 on 1 and 2582 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
<p>We can check linear-log transform as well</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span> 
<span class="nf">hist</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model7</span><span class="p">))</span> 
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model7</span><span class="p">))</span> 
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model7</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a1357dedc8fd0a3233a8f57a74d9314907e6fd04e8bc39df93e03bf2ba7e62be.png" src="../_images/a1357dedc8fd0a3233a8f57a74d9314907e6fd04e8bc39df93e03bf2ba7e62be.png" />
</div>
</div>
</section>
<section id="log-log-transform-the-predictor-and-outcome">
<h4>log-log transform the predictor and outcome<a class="headerlink" href="#log-log-transform-the-predictor-and-outcome" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model8</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">SBP1</span><span class="p">)</span> <span class="o">~</span> <span class="nf">log</span><span class="p">(</span><span class="n">LEAD</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">nhanes_df</span><span class="p">)</span> 
<span class="nf">summary</span><span class="p">(</span><span class="n">model8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = log(SBP1) ~ log(LEAD), data = nhanes_df)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.38441 -0.09593 -0.01050  0.08145  0.58771 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 4.818808   0.002702  1783.1   &lt;2e-16 ***
log(LEAD)   0.049206   0.003755    13.1   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1366 on 2582 degrees of freedom
Multiple R-squared:  0.06235,	Adjusted R-squared:  0.06198 
F-statistic: 171.7 on 1 and 2582 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span> 
<span class="nf">hist</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model8</span><span class="p">))</span> 
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model8</span><span class="p">))</span> 
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model8</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5ad285d756c1a637d8d3d5eed504bc4c978357816035dfddae8f723cda7c1c54.png" src="../_images/5ad285d756c1a637d8d3d5eed504bc4c978357816035dfddae8f723cda7c1c54.png" />
</div>
</div>
</section>
</section>
<section id="evaluation-metrics">
<h3>Evaluation Metrics<a class="headerlink" href="#evaluation-metrics" title="Permalink to this heading">#</a></h3>
<p>There are multiple ways we could use to evaluate the performace of our model</p>
<section id="getting-the-predicted-value">
<h4>Getting the predicted value<a class="headerlink" href="#getting-the-predicted-value" title="Permalink to this heading">#</a></h4>
<p>We will be using model 8, after log-log transformation to satisfy normality assumption, as our final model</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">predicted</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">model8</span><span class="p">)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>27663</dt><dd>4.85647395822307</dd><dt>27664</dt><dd>4.88331907935465</dd><dt>27667</dt><dd>4.85266868683117</dd><dt>27668</dt><dd>4.85116225760374</dd><dt>27670</dt><dd>4.80465247579363</dd><dt>27671</dt><dd>4.81781411311468</dd></dl>
</div></div>
</div>
</section>
<section id="mae">
<h4>MAE<a class="headerlink" href="#mae" title="Permalink to this heading">#</a></h4>
<p>MAE measures the average absolute difference between the predicted values and the actual values. It provides a straightforward way to assess the average magnitude of errors in a predictive model. MAE is less sensitive to outliers compared to other error metrics such as MSE. It is commonly used in regression and forecasting tasks to quantify the average deviation between predicted and observed values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mae</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">SBP1</span> <span class="o">-</span> <span class="n">predicted</span><span class="p">))</span>
<span class="n">mae</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">119.799527203336</div></div>
</div>
</section>
<section id="mse">
<h4>MSE<a class="headerlink" href="#mse" title="Permalink to this heading">#</a></h4>
<p>MSE calculates the average of the squared differences between predicted values and actual values. It is widely used as an error metric for regression tasks. Squaring the errors amplifies larger errors, making MSE more sensitive to outliers than MAE. MSE is often used in model training as an objective function to be minimized, and it provides a measure of the average variance between predicted and observed values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mse</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">((</span><span class="n">SBP1</span><span class="o">-</span> <span class="n">predicted</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="n">mse</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">14689.1410161593</div></div>
</div>
</section>
<section id="aic">
<h4>AIC<a class="headerlink" href="#aic" title="Permalink to this heading">#</a></h4>
<p>AIC is a criterion used for model selection, especially in the context of statistical modeling. It balances the trade-off between model complexity and goodness of fit. AIC takes into account both the goodness of fit (captured by the likelihood of the model) and the complexity of the model (captured by the number of parameters used). Lower AIC values indicate a better trade-off between model complexity and fit. It is often used in regression, time series analysis, and other statistical modeling tasks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">AIC</span><span class="p">(</span><span class="n">model8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">-2951.38174498245</div></div>
</div>
</section>
<section id="bic">
<h4>BIC<a class="headerlink" href="#bic" title="Permalink to this heading">#</a></h4>
<p>BIC, similar to AIC, is a criterion used for model selection. It provides a more stringent penalty for model complexity compared to AIC. BIC incorporates the likelihood of the model, the number of parameters used, and the sample size. BIC tends to penalize more complex models compared to AIC, which makes it useful for preventing overfitting. Lower BIC values indicate better-fitting models. Like AIC, BIC is commonly used in regression, time series analysis, and other statistical modeling tasks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">BIC</span><span class="p">(</span><span class="n">model8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">-2933.81046338774</div></div>
</div>
</section>
</section>
<section id="feature-selection">
<h3>Feature Selection<a class="headerlink" href="#feature-selection" title="Permalink to this heading">#</a></h3>
<p>When there are a lot of variables to choose from, there are multiple ways we could choose which features to use</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="n">nhanes_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 16</caption>
<thead>
	<tr><th></th><th scope=col>ID</th><th scope=col>AGE</th><th scope=col>SEX</th><th scope=col>RACE</th><th scope=col>EDUCATION</th><th scope=col>INCOME</th><th scope=col>SMOKE</th><th scope=col>YEAR</th><th scope=col>LEAD</th><th scope=col>BMI_CAT</th><th scope=col>LEAD_QUANTILE</th><th scope=col>HYP</th><th scope=col>ALC</th><th scope=col>DBP1</th><th scope=col>SBP1</th><th scope=col>EVER_SMOKE</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>27663</th><td>93711</td><td>56</td><td><span style=white-space:pre-wrap>Male  </span></td><td><span style=white-space:pre-wrap>Other Race        </span></td><td>MoreThanHS</td><td>5.00</td><td>NeverSmoke</td><td>2017</td><td>2.15</td><td>BMI&lt;=25</td><td>Q3</td><td>0</td><td>Yes</td><td>68</td><td>108</td><td>No </td></tr>
	<tr><th scope=row>27664</th><td>93713</td><td>67</td><td><span style=white-space:pre-wrap>Male  </span></td><td>Non-Hispanic White</td><td><span style=white-space:pre-wrap>HS        </span></td><td>2.65</td><td>StillSmoke</td><td>2017</td><td>3.71</td><td>BMI&lt;=25</td><td>Q4</td><td>0</td><td>Yes</td><td>70</td><td>104</td><td>Yes</td></tr>
	<tr><th scope=row>27667</th><td>93716</td><td>61</td><td><span style=white-space:pre-wrap>Male  </span></td><td><span style=white-space:pre-wrap>Other Race        </span></td><td>MoreThanHS</td><td>5.00</td><td>QuitSmoke </td><td>2017</td><td>1.99</td><td>BMI&gt;=30</td><td>Q3</td><td>0</td><td>Yes</td><td>72</td><td>120</td><td>Yes</td></tr>
	<tr><th scope=row>27668</th><td>93717</td><td>22</td><td><span style=white-space:pre-wrap>Male  </span></td><td>Non-Hispanic White</td><td><span style=white-space:pre-wrap>HS        </span></td><td>1.49</td><td>StillSmoke</td><td>2017</td><td>1.93</td><td>BMI&lt;=25</td><td>Q3</td><td>0</td><td>Yes</td><td>62</td><td>116</td><td>Yes</td></tr>
	<tr><th scope=row>27670</th><td>93721</td><td>60</td><td>Female</td><td><span style=white-space:pre-wrap>Mexican American  </span></td><td>LessThanHS</td><td>3.04</td><td>NeverSmoke</td><td>2017</td><td>0.75</td><td>BMI&gt;=30</td><td>Q1</td><td>1</td><td>Yes</td><td>68</td><td>132</td><td>No </td></tr>
	<tr><th scope=row>27671</th><td>93722</td><td>60</td><td>Female</td><td>Non-Hispanic White</td><td>MoreThanHS</td><td>2.07</td><td>NeverSmoke</td><td>2017</td><td>0.98</td><td>BMI&lt;=25</td><td>Q2</td><td>0</td><td>Yes</td><td>68</td><td>116</td><td>No </td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">fit.all</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">SBP1</span> <span class="o">~</span> <span class="n">AGE</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">SEX</span><span class="p">)</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">RACE</span><span class="p">)</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">EDUCATION</span><span class="p">)</span> <span class="o">+</span>
              <span class="n">INCOME</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">EVER_SMOKE</span><span class="p">)</span> <span class="o">+</span> <span class="n">LEAD</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">BMI_CAT</span><span class="p">)</span> <span class="o">+</span>
              <span class="nf">factor</span><span class="p">(</span><span class="n">HYP</span><span class="p">)</span> <span class="o">+</span> <span class="n">DBP1</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">LEAD_QUANTILE</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span><span class="n">nhanes_df</span><span class="p">)</span>
<span class="n">intercept_only</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">SBP1</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="forward-selection">
<h4>forward selection<a class="headerlink" href="#forward-selection" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">step</span><span class="p">(</span><span class="n">intercept_only</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s">&#39;forward&#39;</span><span class="p">,</span> <span class="n">scope</span> <span class="o">=</span> <span class="nf">formula</span><span class="p">(</span><span class="n">fit.all</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start:  AIC=15045.17
SBP1 ~ 1

                        Df Sum of Sq    RSS   AIC
+ factor(HYP)            1    303873 568311 13940
+ AGE                    1    171649 700535 14481
+ DBP1                   1    151430 720754 14554
+ factor(LEAD_QUANTILE)  3     51267 820917 14895
+ LEAD                   1     22183 850001 14981
+ factor(BMI_CAT)        2     19790 852394 14990
+ factor(RACE)           4     17740 854444 15000
+ factor(SEX)            1     13666 858518 15006
+ factor(EDUCATION)      2      5000 867184 15034
+ factor(EVER_SMOKE)     1      4318 867866 15034
+ INCOME                 1      1374 870811 15043
&lt;none&gt;                               872184 15045

Step:  AIC=13940.36
SBP1 ~ factor(HYP)

                        Df Sum of Sq    RSS   AIC
+ AGE                    1     39286 529025 13757
+ DBP1                   1     39285 529026 13757
+ factor(LEAD_QUANTILE)  3     11863 556448 13892
+ factor(RACE)           4      7976 560335 13912
+ LEAD                   1      5171 563140 13919
+ factor(EDUCATION)      2      2670 565641 13932
+ INCOME                 1      1653 566658 13935
+ factor(SEX)            1       854 567457 13938
+ factor(BMI_CAT)        2      1205 567105 13939
&lt;none&gt;                               568311 13940
+ factor(EVER_SMOKE)     1       212 568099 13941

Step:  AIC=13757.27
SBP1 ~ factor(HYP) + AGE

                        Df Sum of Sq    RSS   AIC
+ DBP1                   1     55779 473246 13471
+ factor(RACE)           4     10430 518595 13714
+ INCOME                 1      4449 524576 13737
+ factor(EDUCATION)      2      1921 527104 13752
+ factor(BMI_CAT)        2      1453 527572 13754
+ factor(SEX)            1       897 528128 13755
+ factor(LEAD_QUANTILE)  3      1426 527599 13756
+ LEAD                   1       507 528518 13757
&lt;none&gt;                               529025 13757
+ factor(EVER_SMOKE)     1        17 529009 13759

Step:  AIC=13471.36
SBP1 ~ factor(HYP) + AGE + DBP1

                        Df Sum of Sq    RSS   AIC
+ factor(RACE)           4    9205.3 464041 13429
+ INCOME                 1    5985.6 467261 13440
+ factor(EDUCATION)      2    2452.6 470794 13462
+ factor(BMI_CAT)        2    1079.8 472166 13470
+ LEAD                   1     469.0 472777 13471
+ factor(LEAD_QUANTILE)  3    1101.6 472145 13471
&lt;none&gt;                               473246 13471
+ factor(SEX)            1      10.8 473235 13473
+ factor(EVER_SMOKE)     1       1.4 473245 13473

Step:  AIC=13428.6
SBP1 ~ factor(HYP) + AGE + DBP1 + factor(RACE)

                        Df Sum of Sq    RSS   AIC
+ INCOME                 1    3833.8 460207 13409
+ factor(EDUCATION)      2    1680.6 462360 13423
+ LEAD                   1     411.4 463630 13428
&lt;none&gt;                               464041 13429
+ factor(LEAD_QUANTILE)  3    1013.0 463028 13429
+ factor(BMI_CAT)        2     516.1 463525 13430
+ factor(SEX)            1      56.9 463984 13430
+ factor(EVER_SMOKE)     1       3.5 464037 13431

Step:  AIC=13409.16
SBP1 ~ factor(HYP) + AGE + DBP1 + factor(RACE) + INCOME

                        Df Sum of Sq    RSS   AIC
&lt;none&gt;                               460207 13409
+ LEAD                   1    149.67 460057 13410
+ factor(EDUCATION)      2    488.70 459718 13410
+ factor(BMI_CAT)        2    463.54 459744 13411
+ factor(EVER_SMOKE)     1     98.21 460109 13411
+ factor(SEX)            1     69.30 460138 13411
+ factor(LEAD_QUANTILE)  3    692.72 459514 13411
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = SBP1 ~ factor(HYP) + AGE + DBP1 + factor(RACE) + 
    INCOME, data = nhanes_df)

Coefficients:
                   (Intercept)                    factor(HYP)1  
                       75.6294                         13.0856  
                           AGE                            DBP1  
                        0.3226                          0.3966  
    factor(RACE)Other Hispanic  factor(RACE)Non-Hispanic White  
                       -1.5979                         -1.7099  
factor(RACE)Non-Hispanic Black          factor(RACE)Other Race  
                        2.2043                         -2.3157  
                        INCOME  
                       -0.7732  
</pre></div>
</div>
</div>
</div>
</section>
<section id="backward-selection">
<h4>backward selection<a class="headerlink" href="#backward-selection" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">backward</span> <span class="o">&lt;-</span> <span class="nf">step</span><span class="p">(</span><span class="n">fit.all</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s">&#39;backward&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start:  AIC=13418.57
SBP1 ~ AGE + factor(SEX) + factor(RACE) + factor(EDUCATION) + 
    INCOME + factor(EVER_SMOKE) + LEAD + factor(BMI_CAT) + factor(HYP) + 
    DBP1 + factor(LEAD_QUANTILE)

                        Df Sum of Sq    RSS   AIC
- factor(LEAD_QUANTILE)  3       525 458850 13416
- LEAD                   1        21 458346 13417
- factor(SEX)            1        62 458387 13417
- factor(EDUCATION)      2       419 458744 13417
- factor(EVER_SMOKE)     1       200 458525 13418
- factor(BMI_CAT)        2       569 458894 13418
&lt;none&gt;                               458325 13419
- INCOME                 1      2625 460950 13431
- factor(RACE)           4      6442 464767 13447
- AGE                    1     46298 504623 13665
- DBP1                   1     53980 512305 13704
- factor(HYP)            1     68718 527043 13778

Step:  AIC=13415.53
SBP1 ~ AGE + factor(SEX) + factor(RACE) + factor(EDUCATION) + 
    INCOME + factor(EVER_SMOKE) + LEAD + factor(BMI_CAT) + factor(HYP) + 
    DBP1

                     Df Sum of Sq    RSS   AIC
- factor(SEX)         1        64 458914 13414
- factor(EDUCATION)   2       437 459287 13414
- LEAD                1       148 458998 13414
- factor(EVER_SMOKE)  1       205 459055 13415
- factor(BMI_CAT)     2       574 459424 13415
&lt;none&gt;                            458850 13416
- INCOME              1      2653 461503 13428
- factor(RACE)        4      6469 465319 13444
- AGE                 1     52942 511792 13696
- DBP1                1     54288 513138 13702
- factor(HYP)         1     68694 527544 13774

Step:  AIC=13413.89
SBP1 ~ AGE + factor(RACE) + factor(EDUCATION) + INCOME + factor(EVER_SMOKE) + 
    LEAD + factor(BMI_CAT) + factor(HYP) + DBP1

                     Df Sum of Sq    RSS   AIC
- factor(EDUCATION)   2       465 459379 13412
- factor(EVER_SMOKE)  1       173 459087 13413
- LEAD                1       185 459099 13413
- factor(BMI_CAT)     2       555 459469 13413
&lt;none&gt;                            458914 13414
- INCOME              1      2601 461515 13426
- factor(RACE)        4      6433 465347 13442
- AGE                 1     52916 511830 13694
- DBP1                1     55452 514366 13707
- factor(HYP)         1     69690 528604 13777

Step:  AIC=13412.51
SBP1 ~ AGE + factor(RACE) + INCOME + factor(EVER_SMOKE) + LEAD + 
    factor(BMI_CAT) + factor(HYP) + DBP1

                     Df Sum of Sq    RSS   AIC
- factor(EVER_SMOKE)  1       139 459517 13411
- factor(BMI_CAT)     2       553 459932 13412
- LEAD                1       262 459641 13412
&lt;none&gt;                            459379 13412
- INCOME              1      3608 462987 13431
- factor(RACE)        4      6478 465857 13441
- AGE                 1     53689 513067 13696
- DBP1                1     55341 514719 13704
- factor(HYP)         1     69933 529312 13777

Step:  AIC=13411.28
SBP1 ~ AGE + factor(RACE) + INCOME + LEAD + factor(BMI_CAT) + 
    factor(HYP) + DBP1

                  Df Sum of Sq    RSS   AIC
- factor(BMI_CAT)  2       540 460057 13410
- LEAD             1       226 459744 13411
&lt;none&gt;                         459517 13411
- INCOME           1      3472 462989 13429
- factor(RACE)     4      6628 466145 13440
- AGE              1     53573 513090 13694
- DBP1             1     55314 514831 13703
- factor(HYP)      1     69814 529331 13775

Step:  AIC=13410.32
SBP1 ~ AGE + factor(RACE) + INCOME + LEAD + factor(HYP) + DBP1

               Df Sum of Sq    RSS   AIC
- LEAD          1       150 460207 13409
&lt;none&gt;                      460057 13410
- INCOME        1      3572 463630 13428
- factor(RACE)  4      7057 467114 13442
- AGE           1     53941 513998 13695
- DBP1          1     55724 515781 13704
- factor(HYP)   1     73573 533630 13792

Step:  AIC=13409.16
SBP1 ~ AGE + factor(RACE) + INCOME + factor(HYP) + DBP1

               Df Sum of Sq    RSS   AIC
&lt;none&gt;                      460207 13409
- INCOME        1      3834 464041 13429
- factor(RACE)  4      7053 467261 13440
- DBP1          1     55740 515947 13703
- AGE           1     60142 520349 13724
- factor(HYP)   1     73653 533861 13791
</pre></div>
</div>
</div>
</div>
</section>
<section id="both">
<h4>both<a class="headerlink" href="#both" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">both</span> <span class="o">&lt;-</span> <span class="nf">step</span><span class="p">(</span><span class="n">fit.all</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s">&#39;both&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start:  AIC=13418.57
SBP1 ~ AGE + factor(SEX) + factor(RACE) + factor(EDUCATION) + 
    INCOME + factor(EVER_SMOKE) + LEAD + factor(BMI_CAT) + factor(HYP) + 
    DBP1 + factor(LEAD_QUANTILE)

                        Df Sum of Sq    RSS   AIC
- factor(LEAD_QUANTILE)  3       525 458850 13416
- LEAD                   1        21 458346 13417
- factor(SEX)            1        62 458387 13417
- factor(EDUCATION)      2       419 458744 13417
- factor(EVER_SMOKE)     1       200 458525 13418
- factor(BMI_CAT)        2       569 458894 13418
&lt;none&gt;                               458325 13419
- INCOME                 1      2625 460950 13431
- factor(RACE)           4      6442 464767 13447
- AGE                    1     46298 504623 13665
- DBP1                   1     53980 512305 13704
- factor(HYP)            1     68718 527043 13778

Step:  AIC=13415.53
SBP1 ~ AGE + factor(SEX) + factor(RACE) + factor(EDUCATION) + 
    INCOME + factor(EVER_SMOKE) + LEAD + factor(BMI_CAT) + factor(HYP) + 
    DBP1

                        Df Sum of Sq    RSS   AIC
- factor(SEX)            1        64 458914 13414
- factor(EDUCATION)      2       437 459287 13414
- LEAD                   1       148 458998 13414
- factor(EVER_SMOKE)     1       205 459055 13415
- factor(BMI_CAT)        2       574 459424 13415
&lt;none&gt;                               458850 13416
+ factor(LEAD_QUANTILE)  3       525 458325 13419
- INCOME                 1      2653 461503 13428
- factor(RACE)           4      6469 465319 13444
- AGE                    1     52942 511792 13696
- DBP1                   1     54288 513138 13702
- factor(HYP)            1     68694 527544 13774

Step:  AIC=13413.89
SBP1 ~ AGE + factor(RACE) + factor(EDUCATION) + INCOME + factor(EVER_SMOKE) + 
    LEAD + factor(BMI_CAT) + factor(HYP) + DBP1

                        Df Sum of Sq    RSS   AIC
- factor(EDUCATION)      2       465 459379 13412
- factor(EVER_SMOKE)     1       173 459087 13413
- LEAD                   1       185 459099 13413
- factor(BMI_CAT)        2       555 459469 13413
&lt;none&gt;                               458914 13414
+ factor(SEX)            1        64 458850 13416
+ factor(LEAD_QUANTILE)  3       526 458387 13417
- INCOME                 1      2601 461515 13426
- factor(RACE)           4      6433 465347 13442
- AGE                    1     52916 511830 13694
- DBP1                   1     55452 514366 13707
- factor(HYP)            1     69690 528604 13777

Step:  AIC=13412.51
SBP1 ~ AGE + factor(RACE) + INCOME + factor(EVER_SMOKE) + LEAD + 
    factor(BMI_CAT) + factor(HYP) + DBP1

                        Df Sum of Sq    RSS   AIC
- factor(EVER_SMOKE)     1       139 459517 13411
- factor(BMI_CAT)        2       553 459932 13412
- LEAD                   1       262 459641 13412
&lt;none&gt;                               459379 13412
+ factor(EDUCATION)      2       465 458914 13414
+ factor(SEX)            1        92 459287 13414
+ factor(LEAD_QUANTILE)  3       546 458833 13415
- INCOME                 1      3608 462987 13431
- factor(RACE)           4      6478 465857 13441
- AGE                    1     53689 513067 13696
- DBP1                   1     55341 514719 13704
- factor(HYP)            1     69933 529312 13777

Step:  AIC=13411.28
SBP1 ~ AGE + factor(RACE) + INCOME + LEAD + factor(BMI_CAT) + 
    factor(HYP) + DBP1

                        Df Sum of Sq    RSS   AIC
- factor(BMI_CAT)        2       540 460057 13410
- LEAD                   1       226 459744 13411
&lt;none&gt;                               459517 13411
+ factor(EVER_SMOKE)     1       139 459379 13412
+ factor(EDUCATION)      2       430 459087 13413
+ factor(SEX)            1        55 459463 13413
+ factor(LEAD_QUANTILE)  3       546 458971 13414
- INCOME                 1      3472 462989 13429
- factor(RACE)           4      6628 466145 13440
- AGE                    1     53573 513090 13694
- DBP1                   1     55314 514831 13703
- factor(HYP)            1     69814 529331 13775

Step:  AIC=13410.32
SBP1 ~ AGE + factor(RACE) + INCOME + LEAD + factor(HYP) + DBP1

                        Df Sum of Sq    RSS   AIC
- LEAD                   1       150 460207 13409
&lt;none&gt;                               460057 13410
+ factor(BMI_CAT)        2       540 459517 13411
+ factor(EVER_SMOKE)     1       126 459932 13412
+ factor(EDUCATION)      2       430 459627 13412
+ factor(SEX)            1        37 460020 13412
+ factor(LEAD_QUANTILE)  3       555 459502 13413
- INCOME                 1      3572 463630 13428
- factor(RACE)           4      7057 467114 13442
- AGE                    1     53941 513998 13695
- DBP1                   1     55724 515781 13704
- factor(HYP)            1     73573 533630 13792

Step:  AIC=13409.16
SBP1 ~ AGE + factor(RACE) + INCOME + factor(HYP) + DBP1

                        Df Sum of Sq    RSS   AIC
&lt;none&gt;                               460207 13409
+ LEAD                   1       150 460057 13410
+ factor(EDUCATION)      2       489 459718 13410
+ factor(BMI_CAT)        2       464 459744 13411
+ factor(EVER_SMOKE)     1        98 460109 13411
+ factor(SEX)            1        69 460138 13411
+ factor(LEAD_QUANTILE)  3       693 459514 13411
- INCOME                 1      3834 464041 13429
- factor(RACE)           4      7053 467261 13440
- DBP1                   1     55740 515947 13703
- AGE                    1     60142 520349 13724
- factor(HYP)            1     73653 533861 13791
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="reorder">
<h3>reorder()<a class="headerlink" href="#reorder" title="Permalink to this heading">#</a></h3>
<p>We can use reorder() to redefine our reference level</p>
<p>First, Let’s see a linear model with LEAD and gender as independent variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">GENDER</span> <span class="o">&lt;-</span> <span class="n">nhanes_df</span><span class="o">$</span><span class="n">SEX</span>
<span class="n">model9</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">SBP1</span> <span class="o">~</span> <span class="n">LEAD</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">GENDER</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">)</span> 
<span class="nf">summary</span><span class="p">(</span><span class="n">model9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = SBP1 ~ LEAD + factor(GENDER), data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-58.350 -12.654  -2.722   9.463  98.602 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          123.7923     0.6621 186.958  &lt; 2e-16 ***
LEAD                   2.1153     0.2979   7.101 1.60e-12 ***
factor(GENDER)Female  -3.5762     0.7252  -4.931 8.68e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 18.06 on 2581 degrees of freedom
Multiple R-squared:  0.03453,	Adjusted R-squared:  0.03378 
F-statistic: 46.16 on 2 and 2581 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
<p>We can see that the current reference for categorical variable gender is male, indicating that compared to the reference, the response variable, SBP1, is expected to decrease by 3.5762 unit for female while holding all other variables constant. We can also change the reference level by using reorder().</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">GENDER_reordered</span> <span class="o">&lt;-</span> <span class="nf">reorder</span><span class="p">(</span><span class="n">GENDER</span><span class="p">,</span> <span class="n">SBP1</span><span class="p">)</span>
<span class="n">model10</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">SBP1</span> <span class="o">~</span> <span class="n">LEAD</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">GENDER_reordered</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">nhanes_df</span><span class="p">)</span> 
<span class="nf">summary</span><span class="p">(</span><span class="n">model10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = SBP1 ~ LEAD + factor(GENDER_reordered), data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-58.350 -12.654  -2.722   9.463  98.602 

Coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                  120.2160     0.5838 205.932  &lt; 2e-16 ***
LEAD                           2.1153     0.2979   7.101 1.60e-12 ***
factor(GENDER_reordered)Male   3.5762     0.7252   4.931 8.68e-07 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 18.06 on 2581 degrees of freedom
Multiple R-squared:  0.03453,	Adjusted R-squared:  0.03378 
F-statistic: 46.16 on 2 and 2581 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exercise">
<h2>Exercise<a class="headerlink" href="#exercise" title="Permalink to this heading">#</a></h2>
<p>For these exercises, we will be using the NHANES data.</p>
<ol class="arabic simple">
<li><p>Construct a linear model using DBP1 as output and LEAD, AGE, EVER_SMOKE as features, and interpretate each estimate in the output.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#solution:</span>
<span class="n">model_exercise1</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">DBP1</span><span class="o">~</span><span class="n">LEAD</span> <span class="o">+</span> <span class="n">AGE</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">EVER_SMOKE</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_exercise1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = DBP1 ~ LEAD + AGE + factor(EVER_SMOKE), data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-73.974  -6.967  -0.434   7.316  50.941 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           72.24895    0.77541  93.175   &lt;2e-16 ***
LEAD                   0.12689    0.21902   0.579    0.562    
AGE                    0.00671    0.01557   0.431    0.666    
factor(EVER_SMOKE)Yes  0.14339    0.51695   0.277    0.782    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 12.89 on 2580 degrees of freedom
Multiple R-squared:  0.0003463,	Adjusted R-squared:  -0.0008161 
F-statistic: 0.2979 on 3 and 2580 DF,  p-value: 0.8269
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p>Catch the interaction between AGE and EVER_SMOKE in the linear model.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#solution:</span>
<span class="n">model_exercise2</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">DBP1</span><span class="o">~</span><span class="n">LEAD</span> <span class="o">+</span> <span class="n">AGE</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">EVER_SMOKE</span><span class="p">)</span> <span class="o">+</span> <span class="n">EVER_SMOKE</span><span class="o">:</span><span class="n">AGE</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_exercise2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = DBP1 ~ LEAD + AGE + factor(EVER_SMOKE) + EVER_SMOKE:AGE, 
    data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-74.482  -7.351   0.125   7.472  51.543 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           70.08002    0.99390  70.510  &lt; 2e-16 ***
LEAD                   0.11595    0.21857   0.531 0.595804    
AGE                    0.05372    0.02059   2.609 0.009140 ** 
factor(EVER_SMOKE)Yes  5.23750    1.55329   3.372 0.000758 ***
AGE:EVER_SMOKEYes     -0.10447    0.03005  -3.477 0.000516 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 12.86 on 2579 degrees of freedom
Multiple R-squared:  0.00501,	Adjusted R-squared:  0.003467 
F-statistic: 3.247 on 4 and 2579 DF,  p-value: 0.01148
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="3">
<li><p>Draw a qq plot for the model in exercise 2, and describe the distribution.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#solutions:</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_exercise2</span><span class="p">))</span> 
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_exercise2</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span> 
<span class="c1">#qq plot shows a fat-tail trend</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b7b350227f9002d797847f67a16142962efa58f4b2e89e0f54bc24a204e641c0.png" src="../_images/b7b350227f9002d797847f67a16142962efa58f4b2e89e0f54bc24a204e641c0.png" />
</div>
</div>
<ol class="arabic simple" start="4">
<li><p>Check MAE, MSE, and AIC of the model developed in question 2.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#solutions:</span>

<span class="c1">#first find the prediction by this model</span>
<span class="n">predicted</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">model_exercise2</span><span class="p">)</span>

<span class="c1">#mae</span>
<span class="n">mae</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">DBP1</span> <span class="o">-</span> <span class="n">predicted</span><span class="p">))</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#39;MAE: &#39;</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="s">&#39;\n&#39;</span><span class="p">)</span>

<span class="c1">#mse</span>
<span class="n">mse</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">((</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">DBP1</span><span class="o">-</span> <span class="n">predicted</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#39;MSE: &#39;</span><span class="p">,</span> <span class="n">mse</span><span class="p">,</span> <span class="s">&#39;\n&#39;</span><span class="p">)</span>

<span class="c1">#aic</span>
<span class="n">aic</span> <span class="o">&lt;-</span> <span class="nf">AIC</span><span class="p">(</span><span class="n">model_exercise2</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#39;AIC: &#39;</span><span class="p">,</span> <span class="n">aic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE:  9.416108 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE:  165.1751 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC:  20541.58
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="5">
<li><p>Use reorder() to change the reference level of EVER_SMOKE to YES.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#solution:</span>
<span class="n">DBP1</span> <span class="o">&lt;-</span> <span class="n">nhanes_df</span><span class="o">$</span><span class="n">DBP1</span>
<span class="n">EVER_SMOKE</span> <span class="o">&lt;-</span> <span class="n">nhanes_df</span><span class="o">$</span><span class="n">EVER_SMOKE</span>
<span class="n">EVER_SMOKE_reordered</span> <span class="o">&lt;-</span> <span class="nf">reorder</span><span class="p">(</span><span class="n">EVER_SMOKE</span><span class="p">,</span> <span class="o">-</span><span class="n">DBP1</span><span class="p">)</span>
<span class="n">model_exercise5</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">DBP1</span><span class="o">~</span><span class="n">LEAD</span> <span class="o">+</span> <span class="n">AGE</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">EVER_SMOKE_reordered</span><span class="p">)</span> <span class="o">+</span> <span class="n">EVER_SMOKE_reordered</span><span class="o">:</span><span class="n">AGE</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">nhanes_df</span><span class="p">)</span> 
<span class="nf">summary</span><span class="p">(</span><span class="n">model_exercise5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = DBP1 ~ LEAD + AGE + factor(EVER_SMOKE_reordered) + 
    EVER_SMOKE_reordered:AGE, data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-74.482  -7.351   0.125   7.472  51.543 

Coefficients:
                               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                    75.31752    1.19597  62.976  &lt; 2e-16 ***
LEAD                            0.11595    0.21857   0.531 0.595804    
AGE                            -0.05075    0.02268  -2.238 0.025329 *  
factor(EVER_SMOKE_reordered)No -5.23750    1.55329  -3.372 0.000758 ***
AGE:EVER_SMOKE_reorderedNo      0.10447    0.03005   3.477 0.000516 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 12.86 on 2579 degrees of freedom
Multiple R-squared:  0.00501,	Adjusted R-squared:  0.003467 
F-statistic: 3.247 on 4 and 2579 DF,  p-value: 0.01148
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="6">
<li><p>Use DBP1 as outcome, use forward selection method to choose the best model.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#solution:</span>

<span class="c1">#set up model with only intercept and with all variables</span>
<span class="n">fit.all</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">DBP1</span> <span class="o">~</span> <span class="n">AGE</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">SEX</span><span class="p">)</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">RACE</span><span class="p">)</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">EDUCATION</span><span class="p">)</span> <span class="o">+</span>
              <span class="n">INCOME</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">EVER_SMOKE</span><span class="p">)</span> <span class="o">+</span> <span class="n">LEAD</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">BMI_CAT</span><span class="p">)</span> <span class="o">+</span>
              <span class="nf">factor</span><span class="p">(</span><span class="n">HYP</span><span class="p">)</span> <span class="o">+</span> <span class="n">SBP1</span> <span class="o">+</span> <span class="nf">factor</span><span class="p">(</span><span class="n">LEAD_QUANTILE</span><span class="p">),</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">)</span>
<span class="n">intercept_only</span> <span class="o">&lt;-</span> <span class="nf">lm</span><span class="p">(</span><span class="n">DBP1</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nhanes_df</span><span class="p">)</span>

<span class="c1">#forward selection</span>
<span class="n">forward</span> <span class="o">&lt;-</span> <span class="nf">step</span><span class="p">(</span><span class="n">intercept_only</span><span class="p">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="s">&#39;forward&#39;</span><span class="p">,</span> <span class="n">scope</span> <span class="o">=</span> <span class="nf">formula</span><span class="p">(</span><span class="n">fit.all</span><span class="p">),</span> <span class="n">trac</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">forward</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = DBP1 ~ SBP1 + AGE + factor(HYP) + factor(SEX) + 
    INCOME + factor(RACE) + factor(EDUCATION), data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-79.561  -5.513   1.330   6.772  41.791 

Coefficients:
                               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                    45.12623    1.89166  23.855  &lt; 2e-16 ***
SBP1                            0.26914    0.01537  17.515  &lt; 2e-16 ***
AGE                            -0.19997    0.01496 -13.367  &lt; 2e-16 ***
factor(HYP)1                    6.46622    0.56024  11.542  &lt; 2e-16 ***
factor(SEX)Female              -2.33341    0.44395  -5.256 1.59e-07 ***
INCOME                          0.38700    0.14677   2.637  0.00842 ** 
factor(RACE)Other Hispanic      0.32196    0.94760   0.340  0.73407    
factor(RACE)Non-Hispanic White -1.48051    0.71658  -2.066  0.03892 *  
factor(RACE)Non-Hispanic Black -0.71262    0.77267  -0.922  0.35647    
factor(RACE)Other Race          1.00497    0.82069   1.225  0.22086    
factor(EDUCATION)HS             0.20517    0.75494   0.272  0.78582    
factor(EDUCATION)MoreThanHS     1.16773    0.70541   1.655  0.09797 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 11.02 on 2572 degrees of freedom
Multiple R-squared:  0.2715,	Adjusted R-squared:  0.2684 
F-statistic: 87.16 on 11 and 2572 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="9_hypothesis_tests.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">9. Hypothesis Testing</p>
      </div>
    </a>
    <a class="right-next"
       href="11_logistic_regression.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">11. Logistic Regression</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-basics">Linear Regression Basics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-equation-in-matrix-form">Linear Regression Equation in matrix form</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-assumption">Model Assumption</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-in-r">Linear Regression in R</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#eda">EDA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-independent-and-response-variables">Plotting the independent and response variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-the-basic-linear-regression-function-in-r">Using the basic linear regression function in R</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#intepretating-linear-regression-result">Intepretating Linear Regression Result</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#with-categorical-variables">With categorical variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-model-assumptions-with-r">Checking Model Assumptions with R</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#normality">Normality</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#homoscedasticity-and-linearity">homoscedasticity and Linearity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#collinearity">collinearity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#leverage">leverage</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interactive-term">Interactive Term</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transformation">Transformation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#log-linear-transform-the-outcome">log-linear transform the outcome</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-log-transform-the-predictor">linear-log transform the predictor</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#log-log-transform-the-predictor-and-outcome">log-log transform the predictor and outcome</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-metrics">Evaluation Metrics</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-the-predicted-value">Getting the predicted value</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mae">MAE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mse">MSE</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#aic">AIC</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bic">BIC</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-selection">Feature Selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-selection">forward selection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-selection">backward selection</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#both">both</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reorder">reorder()</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alice Paul
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>