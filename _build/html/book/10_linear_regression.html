

<!DOCTYPE html>


<html data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>10. Linear Regression &#8212; R for Health Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/10_linear_regression';</script>
    <link rel="canonical" href="https://alicepaul.github.io/r-for-health-data-science/book/10_linear_regression.html" />
    <link rel="shortcut icon" href="../_static/fav.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11. Logistic Regression" href="11_logistic_regression.html" />
    <link rel="prev" title="9. Hypothesis Testing" href="9_hypothesis_tests.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to R</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_intro_to_r.html">1. Intro to R, RStudio, and Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_data_structures.html">2. Data Structures in R</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_data_files.html">3. Working with Data Files in R</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exploratory Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="4_exploratory_analysis.html">4. Intro to Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_data_transformations_summaries.html">5. Data Transformations and Summaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_merging_data.html">6. Merging and Reshaping Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="7_visualization_ggplot.html">7. Visualization with ggplot2</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Distributions and Hypothesis Testing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="8_distributions.html">8. Probability Distributions in R</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_hypothesis_tests.html">9. Hypothesis Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Regression</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">10. Linear Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_logistic_regression.html">11. Logistic Regression</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extra Topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="12_rmarkdown_reports.html">12. Writing Reports with R Markdown</a></li>

<li class="toctree-l1"><a class="reference internal" href="13_expanding_r_skills.html">13. Expanding your R Skills</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/alicepaul/r-for-health-data-science/master?urlpath=tree/book/10_linear_regression.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/alicepaul/r-for-health-data-science" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/book/10_linear_regression.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>10. Linear Regression</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-model-form-and-assumptions">Linear Regression Model Form and Assumptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-linear-regression">Simple Linear Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-linear-regression">Multiple Linear Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnostic-plots-and-measures">Diagnostic Plots and Measures</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#normality">Normality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#homoscedasticity-linearity-and-collinearity">Homoscedasticity, Linearity, and Collinearity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#leverage-and-influence">Leverage and Influence</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interactions-and-transformations">Interactions and Transformations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-metrics">Evaluation Metrics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stepwise-selection">Stepwise Selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-video">Recap Video</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="linear-regression">
<h1>10. Linear Regression<a class="headerlink" href="#linear-regression" title="Permalink to this headline">#</a></h1>
<p>This chapter will introduce you to linear regression analysis in R. We will cover how to fit linear regression models, checking model assumptions using diagnostic plots, adding transformations and interactions, performance metrics, and variable selection using stepwise selection.</p>
<p>For this chapter, we will use the a samples from the National Health and Nutrition Examination Survey (<a class="reference external" href="https://www.cdc.gov/nchs/nhanes/index.htm">NHANES</a>). The sample contains lead, blood pressure, BMI, smoking status, alcohol use, and demographic variables from NHANES 1999-2018. Variable selection and feature engineering were conducted in an effort to replicate the regression analyses conducted by <span class="xref myst">Huang, Z. (2022). Association Between Blood Lead Level With High Blood Pressure in US (NHANES 1999-2018). Frontiers in Public Health, 892</span>. Use the help operator <code class="docutils literal notranslate"><span class="pre">?NHANESsample</span></code> to read the variable descriptions. Note that we ignore survey weights for this analysis.</p>
<p>We will use the <code class="docutils literal notranslate"><span class="pre">broom</span></code> package to present the estimated coefficients for our regression models and the <code class="docutils literal notranslate"><span class="pre">car</span></code> package to compute variance-inflation factors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">RforHDSdata</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">patchwork</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
<span class="nf">data</span><span class="p">(</span><span class="n">NHANESsample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>── <span class=" -Color -Color-Bold">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">dplyr    </span> 1.1.2     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">readr    </span> 2.1.4
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">forcats  </span> 1.0.0     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">stringr  </span> 1.5.0
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">ggplot2  </span> 3.4.2     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tibble   </span> 3.2.1
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">lubridate</span> 1.9.2     <span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">tidyr    </span> 1.3.0
<span class=" -Color -Color-Green">✔</span> <span class=" -Color -Color-Blue">purrr    </span> 1.0.1     
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>── <span class=" -Color -Color-Bold">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">filter()</span> masks <span class=" -Color -Color-Blue">stats</span>::filter()
<span class=" -Color -Color-Red">✖</span> <span class=" -Color -Color-Blue">dplyr</span>::<span class=" -Color -Color-Green">lag()</span>    masks <span class=" -Color -Color-Blue">stats</span>::lag()
<span class=" -Color -Color-Cyan">ℹ</span> Use the conflicted package (<span class=" -Color -Color-Blue">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading required package: carData
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Attaching package: ‘car’
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following object is masked from ‘package:dplyr’:

    recode
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following object is masked from ‘package:purrr’:

    some
</pre></div>
</div>
</div>
</div>
<section id="linear-regression-model-form-and-assumptions">
<h2>Linear Regression Model Form and Assumptions<a class="headerlink" href="#linear-regression-model-form-and-assumptions" title="Permalink to this headline">#</a></h2>
<p>Recall, that linear regression models an outcome variable <span class="math notranslate nohighlight">\(y\)</span> as a linear combination of independent variables. Suppose we have <span class="math notranslate nohighlight">\(p\)</span> dependent variables, then the model takes the form $<span class="math notranslate nohighlight">\(y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \ldots + \beta_p x_p + \epsilon,\)</span><span class="math notranslate nohighlight">\( where \)</span>\epsilon<span class="math notranslate nohighlight">\( is an error or noise term. In standard linear regression, we assume that \)</span>\epsilon<span class="math notranslate nohighlight">\( is independent and follows a normal distribution \)</span>N(0, \sigma^2)$. From this model form we can extract the key assumptions of linear regression. It’s important to remember these assumptions when checking the model fit and interpreting the model results.</p>
<ul class="simple">
<li><p><strong>Linearity</strong>: The relationship between the independent variables and the dependent variables is linear. This means that the change in the dependent variable is proportional to the change in the independent variable(s). We can check for linearity by examining scatter plots or performing diagnostic tests.</p></li>
<li><p><strong>Independence</strong>: The observations in the dataset are assumed to be independent of each other. There should be no systematic relationship or correlation between the residuals (the differences between the predicted and observed values). Independence can be violated when there is autocorrelation or when observations are clustered or dependent on each other.</p></li>
<li><p><strong>Homoscedasticity</strong>: The variance of the residuals is constant across all levels of the independent variables. In other words, the spread or dispersion of the residuals should remain consistent throughout the range of the independent variable(s). Violations of homoscedasticity, called heteroscedasticity, can lead to biased standard errors and incorrect hypothesis tests.</p></li>
<li><p><strong>Normality</strong>: The residuals follow a normal distribution. This assumption allows for valid hypothesis testing, confidence interval estimation, and prediction intervals. Departures from normality can affect the accuracy of statistical inferences, especially when dealing with small sample sizes. However, the central limit theorem helps to mitigate minor departures from normality in large samples.</p></li>
<li><p><strong>No multicollinearity</strong>: The independent variables should not be highly correlated with each other. High multicollinearity can lead to unstable and unreliable estimates of the coefficients. It becomes challenging to distinguish the individual effects of the independent variables, and the interpretation of the model becomes problematic. Detecting multicollinearity can be done using correlation matrices or variance inflation factor (VIF) calculations. While this is not a direct assumption of the model, it’s an important part of model fitting.</p></li>
</ul>
<p>In Chapter 4, we presented some initial exploratory analysis fo this data. In this chapter, we will use linear regression to understand the assocaition between blood lead levels and systolic blood pressure adjusting for possible confounders. To start, we create columns for systolic and diastolic blood pressure. If an observation has one blood pressure reading, then we use that value. If there is more than one blood pressure reading, then we drop the first observation and average the rest. We do a complete case analysis by dropping any observation with NA values. This leaves us with 30,405 observations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">NHANESsample</span><span class="o">$</span><span class="n">SBP</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">NHANESsample</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;SBP1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SBP2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SBP3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SBP4&quot;</span><span class="p">)],</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">                       </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">case_when</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                             </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span>
<span class="w">                                             </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="m">-1</span><span class="p">],</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)))</span><span class="w"> </span>
<span class="n">NHANESsample</span><span class="o">$</span><span class="n">DBP</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">NHANESsample</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;DBP1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DBP2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DBP3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DBP4&quot;</span><span class="p">)],</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span>
<span class="w">                       </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">case_when</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                             </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span>
<span class="w">                                             </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="m">-1</span><span class="p">],</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)))</span><span class="w">                       </span>
<span class="n">nhanes_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">na.omit</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">NHANESsample</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="n">SBP1</span><span class="p">,</span><span class="w"> </span><span class="n">SBP2</span><span class="p">,</span><span class="w"> </span><span class="n">SBP3</span><span class="p">,</span><span class="w"> </span><span class="n">SBP4</span><span class="p">,</span><span class="w"> </span><span class="n">DBP1</span><span class="p">,</span><span class="w"> </span><span class="n">DBP2</span><span class="p">,</span><span class="w"> </span><span class="n">DBP3</span><span class="p">,</span><span class="w"> </span><span class="n">DBP4</span><span class="p">)))</span>
<span class="nf">dim</span><span class="p">(</span><span class="n">nhanes_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class=list-inline><li>30405</li><li>15</li></ol>
</div></div>
</div>
<p>Next, we make sure any categorical variables are coded as factors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">SEX</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">SEX</span><span class="p">)</span>
<span class="n">nhanes_df</span><span class="o">$</span><span class="n">RACE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">RACE</span><span class="p">)</span>
<span class="n">nhanes_df</span><span class="o">$</span><span class="n">EDUCATION</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">EDUCATION</span><span class="p">)</span>
<span class="n">nhanes_df</span><span class="o">$</span><span class="n">BMI_CAT</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">BMI_CAT</span><span class="p">)</span>
<span class="n">nhanes_df</span><span class="o">$</span><span class="n">LEAD_QUANTILE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">LEAD_QUANTILE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="simple-linear-regression">
<h2>Simple Linear Regression<a class="headerlink" href="#simple-linear-regression" title="Permalink to this headline">#</a></h2>
<p>We will start with simple linear regression. Below we plot the relationship between blood lead level and our outcome systolic blood pressure using the cateogrical variable <code class="docutils literal notranslate"><span class="pre">LEAD_QUANTILE</span></code> and the continuous variable <code class="docutils literal notranslate"><span class="pre">LEAD</span></code>. It easy to visualize the assumptions of simple linear regression. First, the survey sampling for the NHANES survey allows us to assume that each observation is independent. Now, let’s look at the plots below. We expect to see that the average systolic blood pressure increases linearly with blood lead level and that the observations look normally distributed with equal variance along that line. Below, we do not observe that to be the case. We will come back to this in the section on transformations and interactions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">p1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">nhanes_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_density</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">SBP</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">LEAD_QUANTILE</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Systolic Blood Pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Density&quot;</span><span class="p">)</span>
<span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">nhanes_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">LEAD</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">SBP</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Blood Lead Level&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Systolic Blood Pressure&quot;</span><span class="p">)</span>
<span class="n">p1</span><span class="o">/</span><span class="n">p2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3bedc93ceae7b92dcd116b55b94648cfadcbe3b64380d9f48d482277e0885da3.png" src="../_images/3bedc93ceae7b92dcd116b55b94648cfadcbe3b64380d9f48d482277e0885da3.png" />
</div>
</div>
<p>Despite our observations, we will fit a simple linear regression model to explain the association between <code class="docutils literal notranslate"><span class="pre">SBP</span></code> and <code class="docutils literal notranslate"><span class="pre">LEAD</span></code>. The function <code class="docutils literal notranslate"><span class="pre">lm(formula</span> <span class="pre">=</span> <span class="pre">y</span> <span class="pre">~</span> <span class="pre">x,</span> <span class="pre">data)</span></code> fits a linear model in R. The first argument is formula of the linear model. On the left hand side of the <code class="docutils literal notranslate"><span class="pre">~</span></code> we put the outcome variable and on the right hand side we put the dependent variable. When we have multiple depedent variables we separate them with a <code class="docutils literal notranslate"><span class="pre">+</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">y~x1+x2</span></code>). The output of this function is an <code class="docutils literal notranslate"><span class="pre">lm</span></code> object. The <code class="docutils literal notranslate"><span class="pre">summary()</span></code> function will print a summary of the model including the estimated coefficients, information about the residuals, the R-squared and adjusted R-squared values, and the F-statistic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">simp_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">formula</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SBP</span><span class="o">~</span><span class="n">LEAD</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">simp_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = SBP ~ LEAD, data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-96.360 -12.519  -2.791   9.363 140.880 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 120.66481    0.14950  807.11   &lt;2e-16 ***
LEAD          1.70820    0.05802   29.44   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 18.47 on 30403 degrees of freedom
Multiple R-squared:  0.02772,	Adjusted R-squared:  0.02769 
F-statistic: 866.8 on 1 and 30403 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
<p>To visualize this model, we can add the estimated regression line to our scatter plot. In <code class="docutils literal notranslate"><span class="pre">ggplot</span></code>, this can be done with the <code class="docutils literal notranslate"><span class="pre">geom_smooth()</span></code> function. In base R, we use the <code class="docutils literal notranslate"><span class="pre">abline()</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">LEAD</span><span class="p">,</span><span class="w"> </span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">SBP</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Systolic Blood Pressure&quot;</span><span class="p">),</span><span class="n">xlab</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Blood Lead Level&quot;</span><span class="p">),</span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="n">simp_model</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4bf625b1b7e9de376b915091f94c636df59bb991cb2fc4041bfb17d08236ca0d.png" src="../_images/4bf625b1b7e9de376b915091f94c636df59bb991cb2fc4041bfb17d08236ca0d.png" />
</div>
</div>
</section>
<section id="multiple-linear-regression">
<h2>Multiple Linear Regression<a class="headerlink" href="#multiple-linear-regression" title="Permalink to this headline">#</a></h2>
<p>We now create a model adjusting age and sex. We add these into the model by specifying a new formula.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">adj_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">SBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">LEAD</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SEX</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">adj_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = SBP ~ LEAD + AGE + SEX, data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-65.623 -10.592  -1.551   8.547 131.595 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 101.785406   0.303532 335.337  &lt; 2e-16 ***
LEAD          0.400071   0.055246   7.242 4.54e-13 ***
AGE           0.461932   0.005567  82.971  &lt; 2e-16 ***
SEXFemale    -2.777737   0.195674 -14.196  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 16.64 on 30401 degrees of freedom
Multiple R-squared:  0.2116,	Adjusted R-squared:  0.2115 
F-statistic:  2720 on 3 and 30401 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
<p>We can also extract the regression coefficients from the model using the <code class="docutils literal notranslate"><span class="pre">coef()</span></code> function or by using the <code class="docutils literal notranslate"><span class="pre">tidy</span></code> function from the <code class="docutils literal notranslate"><span class="pre">broom</span></code> package. This function puts the coefficient estimates, standard errors, statistics, and p-values in a data frame. We can also add a confidence interval. Below, we add a 95% confidence interval (which is the default value for <code class="docutils literal notranslate"><span class="pre">conf.level</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tidy</span><span class="p">(</span><span class="n">adj_model</span><span class="p">,</span><span class="w"> </span><span class="n">conf.int</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">conf.level</span><span class="o">=</span><span class="m">0.95</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 4 × 7</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>estimate</th><th scope=col>std.error</th><th scope=col>statistic</th><th scope=col>p.value</th><th scope=col>conf.low</th><th scope=col>conf.high</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>(Intercept)</td><td>101.7854062</td><td>0.303531788</td><td>335.33689</td><td>0.000000e+00</td><td>101.1904712</td><td>102.3803413</td></tr>
	<tr><td>LEAD       </td><td>  0.4000715</td><td>0.055246352</td><td>  7.24159</td><td>4.539720e-13</td><td>  0.2917863</td><td>  0.5083566</td></tr>
	<tr><td>AGE        </td><td>  0.4619320</td><td>0.005567391</td><td> 82.97099</td><td>0.000000e+00</td><td>  0.4510196</td><td>  0.4728443</td></tr>
	<tr><td>SEXFemale  </td><td> -2.7777367</td><td>0.195674149</td><td>-14.19573</td><td>1.362265e-45</td><td> -3.1612662</td><td> -2.3942071</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Some other useful summary functions are <code class="docutils literal notranslate"><span class="pre">resid()</span></code>, which returns the residual values for the model, and <code class="docutils literal notranslate"><span class="pre">fitted()</span></code>, which returns the fitted values. We can also predict on new data using the <code class="docutils literal notranslate"><span class="pre">predict()</span></code> function. Below we find the summary of the residual values and then plot the fitted vs true values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">adj_model</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-65.624 -10.592  -1.551   0.000   8.547 131.595 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">()</span><span class="o">+</span><span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">SBP</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="nf">fitted</span><span class="p">(</span><span class="n">adj_model</span><span class="p">)))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;True Systolic Blood Pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Predicted Systolic Blood Pressure&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/439d4188c0075e452b2cbaf46889b69ef7aa405f00d1889bdddd9e343f802ed4.png" src="../_images/439d4188c0075e452b2cbaf46889b69ef7aa405f00d1889bdddd9e343f802ed4.png" />
</div>
</div>
<p>The model summary above shows that the reference level for sex is male. If we want to change our reference level, we can reorder the factor variable by either using the <code class="docutils literal notranslate"><span class="pre">factor()</span></code> function and specifying <code class="docutils literal notranslate"><span class="pre">Female</span></code> as the first level or by using the <code class="docutils literal notranslate"><span class="pre">relevel()</span></code> function. The <code class="docutils literal notranslate"><span class="pre">ref</span></code> argument specifies the new reference level.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">SEX</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">relevel</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">SEX</span><span class="p">,</span><span class="w"> </span><span class="n">ref</span><span class="o">=</span><span class="s">&quot;Female&quot;</span><span class="p">)</span>
<span class="n">adj_model2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">SBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">LEAD</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SEX</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">tidy</span><span class="p">(</span><span class="n">adj_model2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 4 × 5</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>estimate</th><th scope=col>std.error</th><th scope=col>statistic</th><th scope=col>p.value</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>(Intercept)</td><td>99.0076695</td><td>0.292867408</td><td>338.06312</td><td>0.000000e+00</td></tr>
	<tr><td>LEAD       </td><td> 0.4000715</td><td>0.055246352</td><td>  7.24159</td><td>4.539720e-13</td></tr>
	<tr><td>AGE        </td><td> 0.4619320</td><td>0.005567391</td><td> 82.97099</td><td>0.000000e+00</td></tr>
	<tr><td>SEXMale    </td><td> 2.7777367</td><td>0.195674149</td><td> 14.19573</td><td>1.362265e-45</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
<section id="diagnostic-plots-and-measures">
<h2>Diagnostic Plots and Measures<a class="headerlink" href="#diagnostic-plots-and-measures" title="Permalink to this headline">#</a></h2>
<p>We can tell from the above plot that our model doesn’t have a great fit. We will use some diagnostic measures to learn more. R has some built-in plots available for a linear regression model. We plot these below using the <code class="docutils literal notranslate"><span class="pre">plot()</span></code> function. The four plots include (a) Residuals vs Fitted, (b) a QQ-plot for the residuals, (c) Standardized residuals (sqrt) vs Fitted, and (d) Standardized Residuals vs Leverage. In the last plot, you may observe that there is a dashed line. Any points outside of these lines have a Cook’s distance of greater than 0.5. Additionally, points with labels correspond to the points with the largest residuals. So this last plot tries to summarize the outliers, leverage, and influential points. The plots below show that our residuals do not look normally distributed and that we have may have some high leverage points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="c1"># plots all four plots together</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">adj_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/56a9e21bc947c6b2b8d12b7eea8d5e1ea3ac2446aefb1af85e024a88954eccce.png" src="../_images/56a9e21bc947c6b2b8d12b7eea8d5e1ea3ac2446aefb1af85e024a88954eccce.png" />
</div>
</div>
<section id="normality">
<h3>Normality<a class="headerlink" href="#normality" title="Permalink to this headline">#</a></h3>
<p>Beyond the default plots, we can also plot the histogram of the residuals and a qq-plot. The <code class="docutils literal notranslate"><span class="pre">qqnorm()</span></code> and <code class="docutils literal notranslate"><span class="pre">qqline()</span></code> functions can take in the residuals from our model as an argument. The latter adds the theoretical red line for reference. As both the histogram and qq-plot shown, the residuals are positive-skewed, and thus normality of our residuals is not satisfied, we will introduce how we might transform this dataset to satisfy this assumption later in this chapter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="c1"># plot next to each other</span>
<span class="nf">hist</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">adj_model</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Residuals&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;Histogram of Residuals&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">adj_model</span><span class="p">))</span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">adj_model</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span><span class="w"> </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/df7d81ee2966cacda7f3d0510efdb6623096b7d43a3f39685cead883cdf4658d.png" src="../_images/df7d81ee2966cacda7f3d0510efdb6623096b7d43a3f39685cead883cdf4658d.png" />
</div>
</div>
<p>Instead of using the direct residuals, we could also use the standardized residuals using the function <code class="docutils literal notranslate"><span class="pre">rstandard()</span></code>. The standardized residuals are the raw residuals divided by an estimate of the standard deviation for the residual, which will be different for each observation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w"> </span>
<span class="nf">hist</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">adj_model</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Standardized Residuals&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;Histogram of Standardized Residuals&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">adj_model</span><span class="p">))</span><span class="w"> </span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">adj_model</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/18b308c1977cfc623beefc4ef9aa8f252d0089881906ec36fbf6ce284ec293de.png" src="../_images/18b308c1977cfc623beefc4ef9aa8f252d0089881906ec36fbf6ce284ec293de.png" />
</div>
</div>
</section>
<section id="homoscedasticity-linearity-and-collinearity">
<h3>Homoscedasticity, Linearity, and Collinearity<a class="headerlink" href="#homoscedasticity-linearity-and-collinearity" title="Permalink to this headline">#</a></h3>
<p>We can also create a residual vs fitted plot and plot covariates against the residuals. Below, we plot the blood lead level agains the residuals. In both plots, we are looking for the points to be spread roughly evenly around 0 and has no discerning pattern. However, both plots shows a tunnel shape, indicating a growing and shrinking variance of residuals. This indicates that we are violating the homoscedasticity assumption.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="nf">fitted</span><span class="p">(</span><span class="n">adj_model</span><span class="p">),</span><span class="w"> </span><span class="nf">resid</span><span class="p">(</span><span class="n">adj_model</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Fitted Values&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">LEAD</span><span class="p">,</span><span class="w"> </span><span class="nf">resid</span><span class="p">(</span><span class="n">adj_model</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Blood Lead Level&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;Residuals&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/67d75dd3745956e557b6829344fc3cebeb5fb36e69638dcf39cbdf761a14300c.png" src="../_images/67d75dd3745956e557b6829344fc3cebeb5fb36e69638dcf39cbdf761a14300c.png" />
</div>
</div>
<p>To quantify any collinearity between the included covariates we can use the variance inflation factors. The <code class="docutils literal notranslate"><span class="pre">vif()</span></code> function in the <code class="docutils literal notranslate"><span class="pre">car</span></code> package allows us to calculate the variance inflation factors or generalized variance inflation factors for all covariates. In our case, all the VIF values are around 1, indicating low levels of collinearity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">vif</span><span class="p">(</span><span class="n">adj_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>LEAD</dt><dd>1.11804158559488</dd><dt>AGE</dt><dd>1.06971887718661</dd><dt>SEX</dt><dd>1.04860648777136</dd></dl>
</div></div>
</div>
</section>
<section id="leverage-and-influence">
<h3>Leverage and Influence<a class="headerlink" href="#leverage-and-influence" title="Permalink to this headline">#</a></h3>
<p>We may also be interested in how each observation is influencing the model. Leverage values measure how much an individual observation’s <span class="math notranslate nohighlight">\(y\)</span> value influenes its own predicted value and indicate that an observation has extreme predictor values compared to the rest of the data. Leverage values range from 0 to 1 and sum to <span class="math notranslate nohighlight">\(p+1\)</span>, the number of estimated coefficients. Observations with high leverage have the potential to significantly impact the estimated regression coefficients and the overall fit of the model. Therefore, examining leverage values helps identify observations that may be influential or outliers. Below we find the ten highest leverage values and then find those observations in the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">sort</span><span class="p">(</span><span class="nf">hatvalues</span><span class="p">(</span><span class="n">adj_model</span><span class="p">),</span><span class="w"> </span><span class="n">decreasing</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">]</span>
<span class="n">nhanes_df</span><span class="p">[</span><span class="nf">order</span><span class="p">(</span><span class="nf">hatvalues</span><span class="p">(</span><span class="n">adj_model</span><span class="p">),</span><span class="w"> </span><span class="n">decreasing</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),]</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class=dl-inline><dt>23016</dt><dd>0.0389860573783624</dd><dt>2511</dt><dd>0.0293594356273351</dd><dt>3091</dt><dd>0.0226987995842635</dd><dt>21891</dt><dd>0.01484172720611</dd><dt>3661</dt><dd>0.0144327193083266</dd><dt>511</dt><dd>0.0139931863681548</dd><dt>21892</dt><dd>0.0115872145092206</dd><dt>15321</dt><dd>0.0107977666330377</dd><dt>6511</dt><dd>0.0102200419694232</dd><dt>3452</dt><dd>0.00967912154365124</dd></dl>
</div><div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 15</caption>
<thead>
	<tr><th></th><th scope=col>ID</th><th scope=col>AGE</th><th scope=col>SEX</th><th scope=col>RACE</th><th scope=col>EDUCATION</th><th scope=col>INCOME</th><th scope=col>SMOKE</th><th scope=col>YEAR</th><th scope=col>LEAD</th><th scope=col>BMI_CAT</th><th scope=col>LEAD_QUANTILE</th><th scope=col>HYP</th><th scope=col>ALC</th><th scope=col>SBP</th><th scope=col>DBP</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;fct&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>23016</th><td>69212</td><td>38</td><td>Male</td><td><span style=white-space:pre-wrap>Mexican American  </span></td><td>LessThanHS</td><td>1.03</td><td>NeverSmoke</td><td>2011</td><td>61.29</td><td><span style=white-space:pre-wrap>BMI&gt;=30  </span></td><td>Q4</td><td>0</td><td>Yes</td><td>129</td><td>59</td></tr>
	<tr><th scope=row>2511</th><td> 8942</td><td>61</td><td>Male</td><td><span style=white-space:pre-wrap>Other Hispanic    </span></td><td>MoreThanHS</td><td>2.25</td><td>NeverSmoke</td><td>1999</td><td>54.00</td><td>25&lt;BMI&lt;30</td><td>Q4</td><td>1</td><td>Yes</td><td>139</td><td>74</td></tr>
	<tr><th scope=row>3091</th><td>10802</td><td>72</td><td>Male</td><td>Non-Hispanic White</td><td>MoreThanHS</td><td>5.00</td><td>QuitSmoke </td><td>2001</td><td>48.00</td><td><span style=white-space:pre-wrap>BMI&lt;=25  </span></td><td>Q4</td><td>1</td><td>Yes</td><td>154</td><td>82</td></tr>
	<tr><th scope=row>21891</th><td>66079</td><td>54</td><td>Male</td><td>Non-Hispanic Black</td><td><span style=white-space:pre-wrap>HS        </span></td><td>1.65</td><td>StillSmoke</td><td>2011</td><td>38.90</td><td><span style=white-space:pre-wrap>BMI&gt;=30  </span></td><td>Q4</td><td>1</td><td>No </td><td>123</td><td>74</td></tr>
	<tr><th scope=row>3661</th><td>12848</td><td>39</td><td>Male</td><td><span style=white-space:pre-wrap>Mexican American  </span></td><td>MoreThanHS</td><td>4.14</td><td>NeverSmoke</td><td>2001</td><td>38.00</td><td><span style=white-space:pre-wrap>BMI&lt;=25  </span></td><td>Q4</td><td>0</td><td>Yes</td><td>101</td><td>54</td></tr>
	<tr><th scope=row>511</th><td> 1882</td><td>34</td><td>Male</td><td>Non-Hispanic White</td><td><span style=white-space:pre-wrap>HS        </span></td><td>1.36</td><td>StillSmoke</td><td>1999</td><td>37.30</td><td><span style=white-space:pre-wrap>BMI&lt;=25  </span></td><td>Q4</td><td>1</td><td>Yes</td><td>118</td><td>80</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Some other measures of influence are the DFBETAs and the Cook’s distance. These measure how much each observation influences the estimated coefficients and the estimated <code class="docutils literal notranslate"><span class="pre">y</span></code> values, respectively. The <code class="docutils literal notranslate"><span class="pre">influence.measures()</span></code> function provides a set of measures, including the DFBETAS for each model variable, DFFITS, covariance ratios, Cook’s distances and the leverage values, that quantify the influence of each observation on a linear regression model. The output returns the values in a matrix called <code class="docutils literal notranslate"><span class="pre">infmat</span></code>, which we convert to a data frame below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">inf_mat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">influence.measures</span><span class="p">(</span><span class="n">adj_model</span><span class="p">)[[</span><span class="s">&#39;infmat&#39;</span><span class="p">]]</span>
<span class="nf">as.data.frame</span><span class="p">(</span><span class="n">inf_mat</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 8</caption>
<thead>
	<tr><th></th><th scope=col>dfb.1_</th><th scope=col>dfb.LEAD</th><th scope=col>dfb.AGE</th><th scope=col>dfb.SEXF</th><th scope=col>dffit</th><th scope=col>cov.r</th><th scope=col>cook.d</th><th scope=col>hat</th></tr>
	<tr><th></th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td> 0.0138799518</td><td>-0.0175643062</td><td>-1.683345e-02</td><td> 0.0083187286</td><td>-0.034265619</td><td>0.9995083</td><td>2.934831e-04</td><td>1.898938e-04</td></tr>
	<tr><th scope=row>2</th><td>-0.0007323058</td><td> 0.0003481166</td><td>-3.918891e-05</td><td> 0.0010513411</td><td>-0.001495317</td><td>1.0001932</td><td>5.590112e-07</td><td>6.607023e-05</td></tr>
	<tr><th scope=row>3</th><td> 0.0221373044</td><td> 0.0057489501</td><td>-1.454111e-02</td><td>-0.0168432662</td><td> 0.029635103</td><td>0.9988200</td><td>2.194905e-04</td><td>8.280908e-05</td></tr>
	<tr><th scope=row>4</th><td> 0.0004990424</td><td> 0.0010428901</td><td>-2.072439e-03</td><td> 0.0016309535</td><td>-0.003115033</td><td>1.0002393</td><td>2.425931e-06</td><td>1.184573e-04</td></tr>
	<tr><th scope=row>5</th><td> 0.0022594480</td><td>-0.0027253450</td><td>-2.499295e-03</td><td> 0.0009734915</td><td>-0.004978427</td><td>1.0003527</td><td>6.196367e-06</td><td>2.349179e-04</td></tr>
	<tr><th scope=row>6</th><td>-0.0012828825</td><td>-0.0005585861</td><td> 1.647487e-03</td><td>-0.0029288547</td><td>-0.004412697</td><td>1.0001808</td><td>4.868096e-06</td><td>8.089475e-05</td></tr>
</tbody>
</table>
</div></div>
</div>
</section>
</section>
<section id="interactions-and-transformations">
<h2>Interactions and Transformations<a class="headerlink" href="#interactions-and-transformations" title="Permalink to this headline">#</a></h2>
<p>We now try to update our model. To start, we look at potential transformations for our outcome variable. We will consider a log transformation for our outcome systolic blood pressure and blood lead level. Both of these variables have a fairly skewed distribution and may benefit from a transformation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">SBP</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Systolic Blood Pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">SBP</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Log Systolic Blood Pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">LEAD</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Blood Lead Level&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">LEAD</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Log Blood Lead Level&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1da423569559c222449d826658fd7b3c54295cde86fd6db29bd0491a9731913b.png" src="../_images/1da423569559c222449d826658fd7b3c54295cde86fd6db29bd0491a9731913b.png" />
</div>
</div>
<p>To add a transformation to a model we can apply the transformation in the formula. We will calculate the adjusted R-squared for each potential model to compare the fit and plot the four qq-plots. Both indicate that the log-log transformation is the best fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model_nlog_nlog</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">SBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">LEAD</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SEX</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nhanes_df</span><span class="p">)</span>
<span class="n">model_log_nlog</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">SBP</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">LEAD</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SEX</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nhanes_df</span><span class="p">)</span>
<span class="n">model_nlog_log</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">SBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">LEAD</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SEX</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nhanes_df</span><span class="p">)</span>
<span class="n">model_log_log</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">SBP</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">LEAD</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SEX</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nhanes_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">model_nlog_nlog</span><span class="p">)</span><span class="o">$</span><span class="n">adj.r.squared</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_log_nlog</span><span class="p">)</span><span class="o">$</span><span class="n">adj.r.squared</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_nlog_log</span><span class="p">)</span><span class="o">$</span><span class="n">adj.r.squared</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_log_log</span><span class="p">)</span><span class="o">$</span><span class="n">adj.r.squared</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">0.211537840756953</div><div class="output text_html">0.214603653971852</div><div class="output text_html">0.211921039002733</div><div class="output text_html">0.215018947009572</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_nlog_nlog</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;Original Model&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_nlog_nlog</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_log_nlog</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;Log SBP&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_log_nlog</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_nlog_log</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;Log Lead&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_nlog_log</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_log_log</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;Log SBP, Log Lead&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_log_log</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e7d5eb951508328d4b9c997afa5beeac05acbb01f1d7587c1370d0746fb12434.png" src="../_images/e7d5eb951508328d4b9c997afa5beeac05acbb01f1d7587c1370d0746fb12434.png" />
</div>
</div>
<p>We can modify the above code to add square root transformations or inverse transformations. Additionally, we might consider polynomial transformations. The <code class="docutils literal notranslate"><span class="pre">poly(x,</span> <span class="pre">degree=1)</span></code> function allows us to specify a polynomial transformation where we might have higher degree terms. We do not pursue this for this example but show some example code below to create a cubic transformation for blood lead level.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model_poly</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">SBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">poly</span><span class="p">(</span><span class="n">LEAD</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SEX</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nhanes_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can summarize the outcome for our log-log model using the <code class="docutils literal notranslate"><span class="pre">tidy()</span></code> function again. We observe small p-values for each estimated coefficient.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">tidy</span><span class="p">(</span><span class="n">model_log_log</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 4 × 5</caption>
<thead>
	<tr><th scope=col>term</th><th scope=col>estimate</th><th scope=col>std.error</th><th scope=col>statistic</th><th scope=col>p.value</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>(Intercept)</td><td>4.620621472</td><td>2.391943e-03</td><td>1931.743667</td><td>0.000000e+00</td></tr>
	<tr><td>log(LEAD)  </td><td>0.008909484</td><td>1.183673e-03</td><td>   7.526978</td><td>5.336443e-14</td></tr>
	<tr><td>AGE        </td><td>0.003494946</td><td>4.573668e-05</td><td>  76.414522</td><td>0.000000e+00</td></tr>
	<tr><td>SEXMale    </td><td>0.025427995</td><td>1.547464e-03</td><td>  16.432047</td><td>2.055983e-60</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Another type of transformation is an interaction term. For example, we may consider an interaction between sex and blood lead level. We add an interaction to the formula using a <code class="docutils literal notranslate"><span class="pre">:</span></code> between the two variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model_interaction</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">SBP</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="n">LEAD</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SEX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SEX</span><span class="o">:</span><span class="nf">log</span><span class="p">(</span><span class="n">LEAD</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">nhanes_df</span><span class="p">)</span><span class="w"> </span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_interaction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = log(SBP) ~ log(LEAD) + AGE + SEX + SEX:log(LEAD), 
    data = nhanes_df)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.69806 -0.08161 -0.00491  0.07524  0.65992 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)        4.621e+00  2.387e-03 1936.15   &lt;2e-16 ***
log(LEAD)          2.364e-02  1.681e-03   14.07   &lt;2e-16 ***
AGE                3.448e-03  4.578e-05   75.30   &lt;2e-16 ***
SEXMale            3.323e-02  1.668e-03   19.92   &lt;2e-16 ***
log(LEAD):SEXMale -2.660e-02  2.159e-03  -12.32   &lt;2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1279 on 30400 degrees of freedom
Multiple R-squared:  0.219,	Adjusted R-squared:  0.2189 
F-statistic:  2131 on 4 and 30400 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluation-metrics">
<h2>Evaluation Metrics<a class="headerlink" href="#evaluation-metrics" title="Permalink to this headline">#</a></h2>
<p>Besides the adjusted R-squared, there are other metrics that help us to understand how well our model fits the data and to help with model selection. The <code class="docutils literal notranslate"><span class="pre">AIC()</span></code> and <code class="docutils literal notranslate"><span class="pre">BIC()</span></code> functions find the Akaike information criterion (AIC) and Bayesian information criterion (BIC) values, respectively. Both AIC and BIC balance the trade-off between model complexity and goodness of fit. AIC takes into account both the goodness of fit (captured by the likelihood of the model) and the complexity of the model (captured by the number of parameters used). Lower AIC values are preferable. BIC is similar to AIC but has a stronger penalty for model complexity compared to AIC. Both measures indicate a preference for keeping the interaction term.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">AIC</span><span class="p">(</span><span class="n">model_log_log</span><span class="p">)</span>
<span class="nf">AIC</span><span class="p">(</span><span class="n">model_interaction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">-38610.4729782001</div><div class="output text_html">-38759.9576679275</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">BIC</span><span class="p">(</span><span class="n">model_log_log</span><span class="p">)</span>
<span class="nf">BIC</span><span class="p">(</span><span class="n">model_interaction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">-38568.8611664623</div><div class="output text_html">-38710.0234938422</div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">predict()</span></code> function allows us to calculate the predicted <code class="docutils literal notranslate"><span class="pre">y</span></code> values. When called on a model with no data specified, it returns the predicted values for the training data. We could also specify new data using the <code class="docutils literal notranslate"><span class="pre">newdata</span></code> argument. The new data provided must contain the columns given in the model formula. We use the <code class="docutils literal notranslate"><span class="pre">predict()</span></code> function to find the predicted values and then calculate the mean absolute error (MAE) and mean squared error (MSE) for our model. MAE is less sensitive to outliers compared to MSE.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">pred_y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">model_interaction</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mae</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">SBP</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pred_y</span><span class="p">))</span>
<span class="n">mae</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">118.96266105268</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mse</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mean</span><span class="p">((</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">SBP</span><span class="o">-</span><span class="w"> </span><span class="n">pred_y</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="n">mse</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">14501.9230485642</div></div>
</div>
</section>
<section id="stepwise-selection">
<h2>Stepwise Selection<a class="headerlink" href="#stepwise-selection" title="Permalink to this headline">#</a></h2>
<p>So far we have ignored the other variables in the data frame. When performing variable selection, there are multiple methods to use. We will end this chapter by demonstrating how to implement stepwise selection in R. The <code class="docutils literal notranslate"><span class="pre">step()</span></code> function takes in an initial model to perform stepwise selection on along with a direction <code class="docutils literal notranslate"><span class="pre">direction</span></code> (“forward”, “backward”, or “both”), and a scope <code class="docutils literal notranslate"><span class="pre">scope</span></code>. The scope specifies the lower and upper formula to consider. Below we use forward selection so the lower formula is the formula for our current model and the upper formula contains the other covariates we are considering adding in. These two formulas must be nested - that is all terms in the lower formula must be contained in the upper formula.</p>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">step()</span></code> function prints each step in the process and uses AIC to . We can set <code class="docutils literal notranslate"><span class="pre">trace=0</span></code> to avoid the print behavior and update the argument <code class="docutils literal notranslate"><span class="pre">k</span></code> to <code class="docutils literal notranslate"><span class="pre">log(n)</span></code> to use BIC, where <code class="docutils literal notranslate"><span class="pre">n</span></code> is the number of observations. Below we see that the algorithm first adds in race, then BMI, then income, then education, then smoking status. In fact, all variables were added to the model! The final output is an lm object that we can use. We get the summary of the final model and see that the adjusted R-squared has improved to 0.2479.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mod_step</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="n">model_interaction</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;forward&#39;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;log(SBP) ~ log(LEAD) + AGE + SEX:log(LEAD)&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                              </span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;log(SBP) ~ log(LEAD) + AGE + SEX:log(LEAD) + SEX + RACE + EDUCATION + SMOKE +</span>
<span class="s">              INCOME + BMI_CAT&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start:  AIC=-125047.6
log(SBP) ~ log(LEAD) + AGE + SEX + SEX:log(LEAD)

            Df Sum of Sq    RSS     AIC
+ RACE       4    9.1605 488.19 -125605
+ BMI_CAT    2    8.9722 488.38 -125597
+ INCOME     1    2.8709 494.48 -125222
+ EDUCATION  2    1.8966 495.46 -125160
+ SMOKE      2    0.3496 497.00 -125065
&lt;none&gt;                   497.35 -125048

Step:  AIC=-125604.9
log(SBP) ~ log(LEAD) + AGE + SEX + RACE + log(LEAD):SEX

            Df Sum of Sq    RSS     AIC
+ BMI_CAT    2    7.1612 481.03 -126050
+ INCOME     1    1.7985 486.39 -125715
+ EDUCATION  2    1.3404 486.85 -125684
+ SMOKE      2    0.1297 488.06 -125609
&lt;none&gt;                   488.19 -125605

Step:  AIC=-126050.2
log(SBP) ~ log(LEAD) + AGE + SEX + RACE + BMI_CAT + log(LEAD):SEX

            Df Sum of Sq    RSS     AIC
+ INCOME     1   1.61678 479.42 -126151
+ EDUCATION  2   1.11221 479.92 -126117
+ SMOKE      2   0.26139 480.77 -126063
&lt;none&gt;                   481.03 -126050

Step:  AIC=-126150.5
log(SBP) ~ log(LEAD) + AGE + SEX + RACE + BMI_CAT + INCOME + 
    log(LEAD):SEX

            Df Sum of Sq    RSS     AIC
+ EDUCATION  2   0.41789 479.00 -126173
+ SMOKE      2   0.25818 479.16 -126163
&lt;none&gt;                   479.42 -126151

Step:  AIC=-126173
log(SBP) ~ log(LEAD) + AGE + SEX + RACE + BMI_CAT + INCOME + 
    EDUCATION + log(LEAD):SEX

        Df Sum of Sq    RSS     AIC
+ SMOKE  2   0.28648 478.71 -126187
&lt;none&gt;               479.00 -126173

Step:  AIC=-126187.2
log(SBP) ~ log(LEAD) + AGE + SEX + RACE + BMI_CAT + INCOME + 
    EDUCATION + SMOKE + log(LEAD):SEX
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">mod_step</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = log(SBP) ~ log(LEAD) + AGE + SEX + RACE + BMI_CAT + 
    INCOME + EDUCATION + SMOKE + log(LEAD):SEX, data = nhanes_df)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.67127 -0.07992 -0.00393  0.07377  0.67974 

Coefficients:
                         Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept)             4.614e+00  3.316e-03 1391.511  &lt; 2e-16 ***
log(LEAD)               2.282e-02  1.694e-03   13.473  &lt; 2e-16 ***
AGE                     3.485e-03  4.848e-05   71.872  &lt; 2e-16 ***
SEXMale                 3.466e-02  1.655e-03   20.945  &lt; 2e-16 ***
RACEOther Hispanic     -7.106e-03  3.223e-03   -2.205   0.0275 *  
RACENon-Hispanic White -4.449e-03  2.198e-03   -2.024   0.0430 *  
RACENon-Hispanic Black  3.369e-02  2.466e-03   13.662  &lt; 2e-16 ***
RACEOther Race          6.270e-03  3.388e-03    1.850   0.0643 .  
BMI_CAT25&lt;BMI&lt;30        1.513e-02  1.838e-03    8.230  &lt; 2e-16 ***
BMI_CATBMI&gt;=30          3.783e-02  1.835e-03   20.623  &lt; 2e-16 ***
INCOME                 -3.886e-03  4.996e-04   -7.778 7.57e-15 ***
EDUCATIONHS            -1.935e-05  2.186e-03   -0.009   0.9929    
EDUCATIONMoreThanHS    -8.692e-03  2.068e-03   -4.203 2.64e-05 ***
SMOKEQuitSmoke         -7.556e-03  1.796e-03   -4.207 2.60e-05 ***
SMOKEStillSmoke        -4.037e-03  1.943e-03   -2.077   0.0378 *  
log(LEAD):SEXMale      -2.606e-02  2.122e-03  -12.278  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1255 on 30389 degrees of freedom
Multiple R-squared:  0.2483,	Adjusted R-squared:  0.2479 
F-statistic: 669.1 on 15 and 30389 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
</section>
<section id="recap-video">
<h2>Recap Video<a class="headerlink" href="#recap-video" title="Permalink to this headline">#</a></h2>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">#</a></h2>
<p>For these exercises, we will be using the NHANES data.</p>
<ol class="arabic simple">
<li><p>Construct a linear model using <code class="docutils literal notranslate"><span class="pre">DBP1</span></code> as output and <code class="docutils literal notranslate"><span class="pre">LEAD</span></code>, <code class="docutils literal notranslate"><span class="pre">AGE</span></code>, <code class="docutils literal notranslate"><span class="pre">EVER_SMOKE</span></code> as features, and interpretate each estimate in the output.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#solution:</span>
<span class="n">model_exercise1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">DBP</span><span class="o">~</span><span class="n">LEAD</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SMOKE</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_exercise1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = DBP ~ LEAD + AGE + SMOKE, data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-76.894  -7.293   0.561   7.883  60.902 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     71.815455   0.237372 302.544  &lt; 2e-16 ***
LEAD             0.312515   0.044106   7.085 1.42e-12 ***
AGE             -0.034381   0.004683  -7.342 2.16e-13 ***
SMOKEQuitSmoke  -0.707128   0.188252  -3.756 0.000173 ***
SMOKEStillSmoke -0.329253   0.195901  -1.681 0.092829 .  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 13.36 on 30400 degrees of freedom
Multiple R-squared:  0.003634,	Adjusted R-squared:  0.003503 
F-statistic: 27.72 on 4 and 30400 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p>Catch the interaction between <code class="docutils literal notranslate"><span class="pre">AGE</span></code> and <code class="docutils literal notranslate"><span class="pre">EVER_SMOKE</span></code> in the linear model.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#solution:</span>
<span class="n">model_exercise2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">DBP</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">LEAD</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SMOKE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SMOKE</span><span class="o">:</span><span class="n">AGE</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nhanes_df</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_exercise2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = DBP ~ LEAD + AGE + SMOKE + SMOKE:AGE, data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-77.199  -7.265   0.487   7.848  59.681 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         70.654988   0.309311 228.427  &lt; 2e-16 ***
LEAD                 0.303901   0.044021   6.904 5.17e-12 ***
AGE                 -0.009102   0.006298  -1.445    0.148    
SMOKEQuitSmoke       6.207891   0.590710  10.509  &lt; 2e-16 ***
SMOKEStillSmoke     -2.747224   0.572464  -4.799 1.60e-06 ***
AGE:SMOKEQuitSmoke  -0.125788   0.010497 -11.984  &lt; 2e-16 ***
AGE:SMOKEStillSmoke  0.056366   0.012086   4.664 3.12e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 13.31 on 30398 degrees of freedom
Multiple R-squared:  0.0108,	Adjusted R-squared:  0.0106 
F-statistic:  55.3 on 6 and 30398 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="3">
<li><p>Draw a qq plot for the model in exercise 2, and describe the distribution.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#solutions:</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_exercise2</span><span class="p">))</span><span class="w"> </span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">model_exercise2</span><span class="p">),</span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="c1">#qq plot shows a fat-tail trend</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6017c0733efc466cb3a72be4c11648068a1f8ec048b3eee40f17255075622407.png" src="../_images/6017c0733efc466cb3a72be4c11648068a1f8ec048b3eee40f17255075622407.png" />
</div>
</div>
<ol class="arabic simple" start="4">
<li><p>Try some diagnostic plots such as Residual vs. fitted value to see which transformation is fitted for this model.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#solution:</span>

<span class="c1">#use log(DBP1 + 1) beacuase DBP1 has 0, and r can&#39;t deal with log transformation with 0</span>
<span class="c1">#this transformation creates the most outliers, but it also makes the model more normally</span>
<span class="c1">#distributed and Homoscedasticity</span>
<span class="n">model_exercise4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">DBP</span><span class="m">+1</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">LEAD</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AGE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SMOKE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SMOKE</span><span class="o">:</span><span class="n">AGE</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">nhanes_df</span><span class="p">)</span><span class="w"> </span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_exercise4</span><span class="p">)</span>

<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">model_exercise4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Call:
lm(formula = log(DBP + 1) ~ LEAD + AGE + SMOKE + SMOKE:AGE, data = nhanes_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.3384 -0.0748  0.0414  0.1423  0.6465 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          4.2886416  0.0085825 499.697  &lt; 2e-16 ***
LEAD                 0.0032962  0.0012215   2.699  0.00697 ** 
AGE                 -0.0011359  0.0001747  -6.501 8.13e-11 ***
SMOKEQuitSmoke       0.1172809  0.0163905   7.155 8.53e-13 ***
SMOKEStillSmoke     -0.0511110  0.0158842  -3.218  0.00129 ** 
AGE:SMOKEQuitSmoke  -0.0022883  0.0002912  -7.857 4.07e-15 ***
AGE:SMOKEStillSmoke  0.0010002  0.0003354   2.983  0.00286 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.3693 on 30398 degrees of freedom
Multiple R-squared:  0.00883,	Adjusted R-squared:  0.008634 
F-statistic: 45.13 on 6 and 30398 DF,  p-value: &lt; 2.2e-16
</pre></div>
</div>
<img alt="../_images/af3b822c073768d9a0a2bd7b157147f9b28f2ff68600d7607ad2d506dcaeda6f.png" src="../_images/af3b822c073768d9a0a2bd7b157147f9b28f2ff68600d7607ad2d506dcaeda6f.png" />
</div>
</div>
<ol class="arabic simple" start="5">
<li><p>Check MAE, MSE, and AIC of the model developed in question 2.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#solutions:</span>

<span class="c1">#first find the prediction by this model</span>
<span class="n">predicted</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">model_exercise2</span><span class="p">)</span>

<span class="c1">#mae</span>
<span class="n">mae</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">DBP</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">predicted</span><span class="p">))</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#39;MAE: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">mae</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;\n&#39;</span><span class="p">)</span>

<span class="c1">#mse</span>
<span class="n">mse</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mean</span><span class="p">((</span><span class="n">nhanes_df</span><span class="o">$</span><span class="n">DBP</span><span class="o">-</span><span class="w"> </span><span class="n">predicted</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#39;MSE: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">mse</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;\n&#39;</span><span class="p">)</span>

<span class="c1">#aic</span>
<span class="n">aic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">AIC</span><span class="p">(</span><span class="n">model_exercise2</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">&#39;AIC: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE:  9.748759 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE:  177.1186 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC:  243702.9
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="7">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">DBP1</span></code> as outcome, use forward selection method to choose the best model.</p></li>
</ol>
<p>TODO: suppress messages and warnings</p>
<p>TODO: formula . and -</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="9_hypothesis_tests.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">9. Hypothesis Testing</p>
      </div>
    </a>
    <a class="right-next"
       href="11_logistic_regression.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">11. Logistic Regression</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression-model-form-and-assumptions">Linear Regression Model Form and Assumptions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-linear-regression">Simple Linear Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-linear-regression">Multiple Linear Regression</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnostic-plots-and-measures">Diagnostic Plots and Measures</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#normality">Normality</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#homoscedasticity-linearity-and-collinearity">Homoscedasticity, Linearity, and Collinearity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#leverage-and-influence">Leverage and Influence</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#interactions-and-transformations">Interactions and Transformations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-metrics">Evaluation Metrics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stepwise-selection">Stepwise Selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-video">Recap Video</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alice Paul
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>