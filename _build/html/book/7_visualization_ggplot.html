

<!DOCTYPE html>


<html data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>7. Visualization with ggplot2 &#8212; R for Health Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/7_visualization_ggplot';</script>
    <link rel="canonical" href="https://alicepaul.github.io/r-for-health-data-science/book/7_visualization_ggplot.html" />
    <link rel="shortcut icon" href="../_static/fav.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Probability Distributions in R" href="8_distributions.html" />
    <link rel="prev" title="6. Merging and Reshaping Data" href="6_merging_data.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction to R</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_intro_to_r.html">1. Intro to R, RStudio, and Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_data_structures.html">2. Data Structures in R</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_data_files.html">3. Working with Data Files in R</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exploratory Analysis</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="4_exploratory_analysis.html">4. Intro to Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_data_transformations_summaries.html">5. Data Transformations and Summaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_merging_data.html">6. Merging and Reshaping Data</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">7. Visualization with ggplot2</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Distributions and Hypothesis Testing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="8_distributions.html">8. Probability Distributions in R</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_hypothesis_tests.html">9. Hypothesis Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Regression</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="10_linear_regression.html">10. Linear Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_logistic_regression.html">11. Logistic Regression</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Extra Topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="12_rmarkdown_reports.html">12. Writing Reports in R Markdown</a></li>

<li class="toctree-l1"><a class="reference internal" href="13_expanding_r_skills.html">13. Expanding your R Skills</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/alicepaul/r-for-health-data-science/master?urlpath=tree/book/7_visualization_ggplot.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/alicepaul/r-for-health-data-science" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/book/7_visualization_ggplot.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>7. Visualization with ggplot2</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#intro-to-ggplot">Intro to ggplot</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#practice-question">Practice Question</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adjusting-the-axes-and-aesthetics">Adjusting the Axes and Aesthetics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-groups">Adding Groups</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Practice Question</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-options">Extra Options</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-video">Recap Video</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="visualization-with-ggplot2">
<h1>7. Visualization with ggplot2<a class="headerlink" href="#visualization-with-ggplot2" title="Permalink to this headline">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> is another useful package in the tidyverse that allows statisticians to use visualizations to communicate key findings and results in a compelling format. We will first learn about the three main components in a ggplot object and then expand on that format by learning more about the different layers we can use to create various plots. As with the tidyverse functions, there are quite a few functions to cover, and the functions build on each other.</p>
<p>The three packages we will use in this chapter are <code class="docutils literal notranslate"><span class="pre">tidyverse</span></code>, <code class="docutils literal notranslate"><span class="pre">RforHDSdata</span></code>, and <code class="docutils literal notranslate"><span class="pre">patchwork</span></code>, the last of which is a nice package for combining multiple plots together into a single figure. We will use the data from the Pittsburgh pain clinic introduced in <a class="reference external" href="https://alicepaul.github.io/r-for-health-data-science/book/3_data_files.html">Chapter 3</a> to create our visuals. You can refresh your memory about this data by reading the data documentation. For the purposes of this chapter, we take a sample of 5,000 patients that are complete cases at baseline to reduce the computation time to display each plot. You can ignore how the code used to find this sample works.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">suppressPackageStartupMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">))</span>
<span class="nf">suppressPackageStartupMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="n">RforHDSdata</span><span class="p">))</span>
<span class="nf">suppressPackageStartupMessages</span><span class="p">(</span><span class="nf">library</span><span class="p">(</span><span class="n">patchwork</span><span class="p">))</span>
<span class="nf">data</span><span class="p">(</span><span class="n">pain</span><span class="p">)</span>

<span class="c1"># sampling data</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">5</span><span class="p">)</span>
<span class="n">pain_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pain</span><span class="p">[</span><span class="nf">complete.cases</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">pain</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                      </span><span class="n">select</span><span class="o">=-</span><span class="nf">c</span><span class="p">(</span><span class="n">PAIN_INTENSITY_AVERAGE.FOLLOW_UP</span><span class="p">))),]</span>
<span class="n">pain_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pain_df</span><span class="p">[</span><span class="nf">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">pain_df</span><span class="p">),</span><span class="w"> </span><span class="m">5000</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">),]</span><span class="w"> </span>
</pre></div>
</div>
</div>
</div>
<section id="intro-to-ggplot">
<h2>Intro to ggplot<a class="headerlink" href="#intro-to-ggplot" title="Permalink to this headline">#</a></h2>
<p>We’ll begin by demonstrating how to create a scatter plot in <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> to introduce the three key elements of a <code class="docutils literal notranslate"><span class="pre">ggplot2</span></code> object. Specifically, we will create a scatter plot of a patient’s depression vs. anxiety score. To start a graph, we can use the <code class="docutils literal notranslate"><span class="pre">ggplot()</span></code> function to create a <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> object as below. Note that this brings up a gray box - this will be the base that we will build up from.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1ca959aec4afccf325e13648a682ae165ac7aeb32da6e40a4949f6bc6ab5881a.png" src="../_images/1ca959aec4afccf325e13648a682ae165ac7aeb32da6e40a4949f6bc6ab5881a.png" />
</div>
</div>
<p>Now we can start adding layers to our <code class="docutils literal notranslate"><span class="pre">ggplot</span></code> object. One type of layer is a <strong>geom</strong>, which creates a geometric object. Below, we use the <code class="docutils literal notranslate"><span class="pre">geom_point()</span></code> function to add a scatter plot layer. For this function, we first need to specify which data we want to use, and then we need to tell R how to use that data to create the scatter plot using the <code class="docutils literal notranslate"><span class="pre">aes()</span></code> function, which creates an <strong>aesthetic</strong>. For a scatter plot, we need to at least specify the x-axis and y-axis in the aesthetic. Both the data and the aesthetic can either be specified in our initial <code class="docutils literal notranslate"><span class="pre">ggplot()</span></code> function, which will pass this information to all future layers, or in the <code class="docutils literal notranslate"><span class="pre">geom_point()</span></code> function itself. Below, we specify the aesthetic in the geom function but also include two alternative ways to code the same image that are commented out. The resulting plot shows a fairly linear relationship between anxiety and depression.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PROMIS_ANXIETY</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PROMIS_DEPRESSION</span><span class="p">))</span>
<span class="c1"># ggplot(pain_df, aes(x=PROMIS_ANXIETY, y = PROMIS_DEPRESSION)) + geom_point()</span>
<span class="c1"># ggplot() + geom_point(data = pain_df, aes(x=PROMIS_ANXIETY, y = PROMIS_DEPRESSION))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d2eb530050b8dc63ad4650eb19739ff77ef99d97034c3a447f2938a029acebac.png" src="../_images/d2eb530050b8dc63ad4650eb19739ff77ef99d97034c3a447f2938a029acebac.png" />
</div>
</div>
<p>If we want to improve our plot, we may want to add different labels and a title. To do so, we use the <code class="docutils literal notranslate"><span class="pre">labs()</span></code> function to add a layer in which we can specify all labels. Additionally, I have passed more information to the geometry layer by changing the <a class="reference external" href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html">color, size, and shape</a> of the points. These things are specified outside of the <code class="docutils literal notranslate"><span class="pre">aes()</span></code> function since they do not come from the data - every point has the same color, size, and shape in this example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PROMIS_ANXIETY</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PROMIS_DEPRESSION</span><span class="p">),</span><span class="w"> </span>
<span class="w">             </span><span class="n">color</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="o">=</span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;PROMIS Anxiety Score&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;PROMIS Depression Score&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Depression vs Anxiety Scores&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d788217aaee2b4d24b9436977e30fdbe00668035a32dd0a363163b0463282c82.png" src="../_images/d788217aaee2b4d24b9436977e30fdbe00668035a32dd0a363163b0463282c82.png" />
</div>
</div>
<p>Let’s create another example. This time, I will create a histogram for initial recorded pain level. To find the corresponding geom for the type of plot we’d like to make, we can use the <a class="reference external" href="https://posit.co/wp-content/uploads/2022/10/data-visualization-1.pdf">data visualization cheat sheet from Posit</a>. The first page lists all the geom options available along with what aesthetics we can set for each option. For example, here we are interested in plotting the distribution of one continuous variable, and under the <code class="docutils literal notranslate"><span class="pre">geom_histogram()</span></code> function we can see that we can specify <code class="docutils literal notranslate"><span class="pre">x</span></code> (the variable whose distribution we want to plot) as well as <code class="docutils literal notranslate"><span class="pre">binwidth</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">alpha</span></code>, <code class="docutils literal notranslate"><span class="pre">color</span></code>, <code class="docutils literal notranslate"><span class="pre">fill</span></code>, <code class="docutils literal notranslate"><span class="pre">linetype</span></code>, <code class="docutils literal notranslate"><span class="pre">size</span></code>, and <code class="docutils literal notranslate"><span class="pre">weight</span></code>. By default, the <code class="docutils literal notranslate"><span class="pre">y</span></code> value in a histogram is the count for each bin.</p>
<p>In the code below, you can see that we updated the color (<code class="docutils literal notranslate"><span class="pre">color</span></code>), fill (<code class="docutils literal notranslate"><span class="pre">fill</span></code>), and opacity (<code class="docutils literal notranslate"><span class="pre">alpha</span></code>) of our histogram bars and updated the number of bins to be 11 (to account for the possible values 0-10). Additionally, we used the <code class="docutils literal notranslate"><span class="pre">theme_minimal()</span></code> function to change the background colors used. You can find the available themes on the second page of the cheat sheet. Try changing the theme of the above plot to <code class="docutils literal notranslate"><span class="pre">theme_bw()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PAIN_INTENSITY_AVERAGE</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">&quot;violetred&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;lightblue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Patient Reported Pain Intensity&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Count&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08489c2f61fc26c997b8aac0df004a4163a8dfd7875d9841efcf2ad1551ca655.png" src="../_images/08489c2f61fc26c997b8aac0df004a4163a8dfd7875d9841efcf2ad1551ca655.png" />
</div>
</div>
<section id="practice-question">
<h3>Practice Question<a class="headerlink" href="#practice-question" title="Permalink to this headline">#</a></h3>
<p>Recreate the following plot.</p>
<a class="reference internal image-reference" href="../_images/7-practicequestion1answer.png"><img alt="“”" class="align-center" src="../_images/7-practicequestion1answer.png" style="width: 400pt;" /></a>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Insert your solution here: </span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="adjusting-the-axes-and-aesthetics">
<h2>Adjusting the Axes and Aesthetics<a class="headerlink" href="#adjusting-the-axes-and-aesthetics" title="Permalink to this headline">#</a></h2>
<p>We can further control how each part specified in the aesthetic is displayed using <strong>scale</strong> functions. For example, suppose that I wanted to update the plot above. In particular, I first want to update the x-axis to display all of the values 0 to 10 instead of 0, 2.5, 5, etc.. To update the x-axis, I need to find the corresponding scale function for x with continuous values. This function is <code class="docutils literal notranslate"><span class="pre">scale_x_continuous()</span></code>, which allows me to specify limits (<code class="docutils literal notranslate"><span class="pre">limits</span></code>), breaks (<code class="docutils literal notranslate"><span class="pre">breaks</span></code>), and labels (<code class="docutils literal notranslate"><span class="pre">labels</span></code>). The scale functions can be found on the second sheet of the cheat sheet. In this case, I just want to update the breaks to be all integer values from 0 to 10.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PAIN_INTENSITY_AVERAGE</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">&quot;violetred&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;lightblue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Patient Reported Pain Intensity&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Count&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="m">0</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/12a55e4e6760f3378e2963043dbf75a93c8ecb560d28a6a9679043759f7d69a6.png" src="../_images/12a55e4e6760f3378e2963043dbf75a93c8ecb560d28a6a9679043759f7d69a6.png" />
</div>
</div>
<p>Now, let’s take a more complex example. The plot below shows each patient’s reported sleep disturbance vs. physical function and colors each point by their reported pain intensity. Since some points might overlap in values, we added <code class="docutils literal notranslate"><span class="pre">position=&quot;jitter&quot;</span></code> to the <code class="docutils literal notranslate"><span class="pre">geom_point()</span></code> function to jitter the points, which corresponds to adding some random noise to each point’s position. As it stands, this plot is difficult to read. For example, the color of pain intensity makes it hard to see how pain changes, and the legend title needs to be simpler.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PROMIS_PHYSICAL_FUNCTION</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">PROMIS_SLEEP_DISTURB_V1_0</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">color</span><span class="o">=</span><span class="n">PAIN_INTENSITY_AVERAGE</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="s">&quot;jitter&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8d3653687079435420bee1e657e6ed072b028ff6cc4ee9d31cd1ba88ba8dba59.png" src="../_images/8d3653687079435420bee1e657e6ed072b028ff6cc4ee9d31cd1ba88ba8dba59.png" />
</div>
</div>
<p>Suppose that we wanted to visualize the pain intensity and sleep disturbance for patients with below-average physical function. Note that both sleep disturbance and physical function are reported as T-Scores, meaning that the raw scores have been converted to a standardized score with mean 50 and standard deviation 10 within the population. We can use the scale functions to update our axes and labels to reflect this information. As before, we need to use the <code class="docutils literal notranslate"><span class="pre">scale_x_continuous()</span></code> function to update the x-axis for a continuous variable. In this case, we update the limits (to restrict to below average physical function), breaks, and labels. We similarly update the y-axis.</p>
<p>Lastly, suppose we want to update the color aesthetic. As before, this aesthetic corresponds to a continuous variable. The cheat sheet provides several possible scale functions depending on how we want to specify the color gradient. We choose the <code class="docutils literal notranslate"><span class="pre">scale_color_gradient()</span></code> function, since this allows us to specify the low and high end colors. We can also specify the breaks for the legend values similar to how we specified the breaks for the x and y axes. The argument <code class="docutils literal notranslate"><span class="pre">name</span></code> also allows us to rename this legend. The palette then converts this to a continuous color gradient. Note that in contrast to the <code class="docutils literal notranslate"><span class="pre">scale_color_gradient()</span></code> function that we chose to use for this example, the functions <code class="docutils literal notranslate"><span class="pre">scale_color_gradient2()</span></code> and <code class="docutils literal notranslate"><span class="pre">scale_color_gradientn()</span></code> allow you to specify more color points in the gradient rather than just the two extreme colors.</p>
<p>We can observe that decreased physical function is associated with higher sleep disturbance and that those with worse physical function and worse sleep disturbance tend to have higher reported pain. Note that this time we receive a warning message, which is because our axis limits have cut off some points. To avoid this message, we could use the function <code class="docutils literal notranslate"><span class="pre">coord_cartesian()</span></code> to specify our limits which clips the values rather than removing points outside the limits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PROMIS_PHYSICAL_FUNCTION</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">PROMIS_SLEEP_DISTURB_V1_0</span><span class="p">,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">color</span><span class="o">=</span><span class="n">PAIN_INTENSITY_AVERAGE</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="s">&quot;jitter&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">15</span><span class="p">,</span><span class="m">50</span><span class="p">),</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">),</span><span class="w"> </span>
<span class="w">                     </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-3 SD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-2 SD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;-1 SD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pop Mean&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="m">70</span><span class="p">,</span><span class="w"> </span><span class="m">80</span><span class="p">),</span><span class="w"> </span>
<span class="w">                     </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;-1 SD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Pop Mean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;+1 SD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;+2 SD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;+3 SD&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_color_gradient</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">low</span><span class="o">=</span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Reported Pain&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;PROMIS Physical Function T-Score&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PROMIS Sleep Disturbance T-Score&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“Removed 121 rows containing missing values (`geom_point()`).”
</pre></div>
</div>
<img alt="../_images/ec881d883cdd36dfe6c6ae498d59af850120564817e830ac8174aceb3ecf5591.png" src="../_images/ec881d883cdd36dfe6c6ae498d59af850120564817e830ac8174aceb3ecf5591.png" />
</div>
</div>
<p>We now demonstrate these scale functions for discrete variables. In the example below, we first create a new race variable that has only three categories since other groups have limited observations. We then create a box plot for pain intensity by race. There are two discrete aesthetics here: color and the y-axis. This plot shows a higher median pain for black patients compared to other races.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">pain_df</span><span class="o">$</span><span class="n">PAT_RACE_CAT</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ifelse</span><span class="p">(</span><span class="n">pain_df</span><span class="o">$</span><span class="n">PAT_RACE</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;BLACK&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WHITE&quot;</span><span class="p">),</span><span class="w"> </span>
<span class="w">                               </span><span class="n">pain_df</span><span class="o">$</span><span class="n">PAT_RACE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;OTHER&quot;</span><span class="p">)</span>
<span class="n">pain_df</span><span class="o">$</span><span class="n">PAT_RACE_CAT</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">pain_df</span><span class="o">$</span><span class="n">PAT_RACE_CAT</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_boxplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">PAT_RACE_CAT</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="n">PAIN_INTENSITY_AVERAGE</span><span class="p">,</span><span class="w"> </span>
<span class="w">                   </span><span class="n">fill</span><span class="o">=</span><span class="n">PAT_RACE_CAT</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9d874f2bf9df8211d83c978ce5d63e9f9e63c59060d1631a54b953faaef88028.png" src="../_images/9d874f2bf9df8211d83c978ce5d63e9f9e63c59060d1631a54b953faaef88028.png" />
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">scale_y_discrete()</span></code> is the scale function that corresponds to a discrete y-axis. In this case, we want to update the order and labels of this y-axis. To update the order, we can either refactor the variable using <code class="docutils literal notranslate"><span class="pre">factor()</span></code> prior to plotting or update the <code class="docutils literal notranslate"><span class="pre">limits</span></code> argument of the scale function. The function <code class="docutils literal notranslate"><span class="pre">scale_fill_brewer()</span></code> is a scale function to control the color palette of a discrete variable used for the fill aesthetic. We use this function to specify the <a class="reference external" href="https://r-graph-gallery.com/38-rcolorbrewers-palettes.html">color palette</a> (<code class="docutils literal notranslate"><span class="pre">palette</span></code>) and to specify that that we do not want a legend (<code class="docutils literal notranslate"><span class="pre">guide</span></code>). Since we do not have a legend, we do not update the values and labels in this function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_boxplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">PAT_RACE_CAT</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="n">PAIN_INTENSITY_AVERAGE</span><span class="p">,</span><span class="w"> </span>
<span class="w">                   </span><span class="n">fill</span><span class="o">=</span><span class="n">PAT_RACE_CAT</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_discrete</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;OTHER&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WHITE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;BLACK&quot;</span><span class="p">),</span><span class="w"> </span>
<span class="w">                   </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Other&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;White&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Black&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="o">=</span><span class="s">&quot;Dark2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">guide</span><span class="o">=</span><span class="s">&quot;none&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Reported Pain Intensity&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Reported Race&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e310486265709fa85061baa7599b3543566ef97c7214b35a01dd698dcd5e5f5e.png" src="../_images/e310486265709fa85061baa7599b3543566ef97c7214b35a01dd698dcd5e5f5e.png" />
</div>
</div>
<p>Here is one more example of how you can use the scale functions - take a look at the code below. We used two <code class="docutils literal notranslate"><span class="pre">geom_histogram()</span></code> calls, or layers, to plot a histogram of pain at baseline and at follow-up. This allows us to visualize that pain at follow-up tends to be lower than at baseline.</p>
<p>We also specify the fill to be by “Baseline” and “Follow-up” within the aesthetic, even though this isn’t a column in the data: this is a sort of manual way to color the bars. We use the <code class="docutils literal notranslate"><span class="pre">scale_fill_manual()</span></code> function to then specify the colors we want to use for these two categories using the <code class="docutils literal notranslate"><span class="pre">values</span></code> argument. We received three warnings when creating this plot! This is because we have many NA values for follow-up and because we did not specify the bin size for either histogram. C’est la vie.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PAIN_INTENSITY_AVERAGE</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;Baseline&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PAIN_INTENSITY_AVERAGE.FOLLOW_UP</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;Follow-Up&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;violetred&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pink&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Measurement&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Reported Pain Intensity&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Count&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“Removed 3604 rows containing non-finite values (`stat_bin()`).”
</pre></div>
</div>
<img alt="../_images/539d72d667f569e1a9d38651153170645536ee4ff15479f27dff166eb137fbe5.png" src="../_images/539d72d667f569e1a9d38651153170645536ee4ff15479f27dff166eb137fbe5.png" />
</div>
</div>
</section>
<section id="adding-groups">
<h2>Adding Groups<a class="headerlink" href="#adding-groups" title="Permalink to this headline">#</a></h2>
<p>In the example above, we created two histograms using two calls to the <code class="docutils literal notranslate"><span class="pre">geom_histogram()</span></code> function, but there is another way to create multiple layers like this when you have a variable that you want to separate the geom layer on. For example, suppose we want to visualize the distribution of physical function by whether someone has follow-up information. Below we create the variable <code class="docutils literal notranslate"><span class="pre">HAS_FOLLOW_UP</span></code> before using it in our aesthetic for <code class="docutils literal notranslate"><span class="pre">geom_density()</span></code> as both the color and group. In fact, we do not have to add the <code class="docutils literal notranslate"><span class="pre">group</span></code> argument because as soon as we specify to R that we want to color the density plots by this variable, R will create the grouping. Finally, we update the legend for this grouping using the <code class="docutils literal notranslate"><span class="pre">scale_color_discrete()</span></code> function, since the discrete variable <code class="docutils literal notranslate"><span class="pre">HAS_FOLLOW_UP</span></code> specifies the color.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">pain_df</span><span class="o">$</span><span class="n">HAS_FOLLOW_UP</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">pain_df</span><span class="o">$</span><span class="n">PAIN_INTENSITY_AVERAGE.FOLLOW_UP</span><span class="p">)</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_density</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PROMIS_PHYSICAL_FUNCTION</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">HAS_FOLLOW_UP</span><span class="p">,</span><span class="w"> </span>
<span class="w">                   </span><span class="n">color</span><span class="o">=</span><span class="n">HAS_FOLLOW_UP</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">scale_color_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Follow-Up&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;No&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Yes&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;PROMIS Physical Function T-Score&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Estimated Density&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/38c5039adbd0395363460fdc61448238de694d053526745bbad76f6bc6eba645.png" src="../_images/38c5039adbd0395363460fdc61448238de694d053526745bbad76f6bc6eba645.png" />
</div>
</div>
<p>Let’s try another example. Suppose that we want to find the distribution of initial overall pain by those that do and do not have follow up. In this case, we want to plot the proportion of each pain score for each group rather than comparing counts. We first need to find these proportions, which we do by grouping and summarizing over our data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">pain_df_grp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pain_df</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">HAS_FOLLOW_UP</span><span class="p">,</span><span class="w"> </span><span class="n">PAIN_INTENSITY_AVERAGE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">summarize</span><span class="p">(</span><span class="n">tot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tot</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">tot</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">ungroup</span><span class="p">()</span>
<span class="nf">head</span><span class="p">(</span><span class="n">pain_df_grp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`summarise()` has grouped output by &#39;HAS_FOLLOW_UP&#39;. You can override using the
`.groups` argument.
</pre></div>
</div>
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 6 × 4</caption>
<thead>
	<tr><th scope=col>HAS_FOLLOW_UP</th><th scope=col>PAIN_INTENSITY_AVERAGE</th><th scope=col>tot</th><th scope=col>prop</th></tr>
	<tr><th scope=col>&lt;lgl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>FALSE</td><td>0</td><td>  8</td><td>0.002219756</td></tr>
	<tr><td>FALSE</td><td>1</td><td> 16</td><td>0.004439512</td></tr>
	<tr><td>FALSE</td><td>2</td><td> 62</td><td>0.017203108</td></tr>
	<tr><td>FALSE</td><td>3</td><td>132</td><td>0.036625971</td></tr>
	<tr><td>FALSE</td><td>4</td><td>273</td><td>0.075749168</td></tr>
	<tr><td>FALSE</td><td>5</td><td>508</td><td>0.140954495</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We can now use the <code class="docutils literal notranslate"><span class="pre">geom_col()</span></code> function to create a bar plot of these proportions. By default, this function will stack the bars on top of each other when there is grouping. Try adding <code class="docutils literal notranslate"><span class="pre">position=&quot;dodge&quot;</span></code> to the <code class="docutils literal notranslate"><span class="pre">geom_col()</span></code> function to place the bars side by side instead of on top of each other.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df_grp</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_col</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PAIN_INTENSITY_AVERAGE</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">prop</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">HAS_FOLLOW_UP</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">scale_fill_discrete</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Seen at Follow Up&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;No&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Yes&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Reported Pain Intensity&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Proportion&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/146719c0d03fcfa8bc5fc212b6e4c28baf1650ed74647bb2268a3f6409a1780c.png" src="../_images/146719c0d03fcfa8bc5fc212b6e4c28baf1650ed74647bb2268a3f6409a1780c.png" />
</div>
</div>
<section id="id1">
<h3>Practice Question<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>Recreate the following plot.</p>
<a class="reference internal image-reference" href="../_images/7-practicequestion2answer.png"><img alt="“”" class="align-center" src="../_images/7-practicequestion2answer.png" style="width: 400pt;" /></a>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Insert your solution here:</span>
</pre></div>
</div>
</div>
</div>
<p>Another way to visualize data by group is to add a facet wrap to your ggplot object. Facets divide a plot into subplots based on one or more discrete variable values. We can either arrange these plots as a grid where the rows and/or columns correspond to the variables we are grouping by using <code class="docutils literal notranslate"><span class="pre">facet_grid()</span></code> and specifying the column and row variables using the <code class="docutils literal notranslate"><span class="pre">col</span></code> and <code class="docutils literal notranslate"><span class="pre">row</span></code> arguments respectively. Or we can wrap the plots into a rectangular format using <code class="docutils literal notranslate"><span class="pre">facet_wrap()</span></code> and specifying the columns using the <code class="docutils literal notranslate"><span class="pre">facet</span></code> argument. Below, we take one of our previous plots and add a facet grid where the columns of the grid are given by racial group. If we had set <code class="docutils literal notranslate"><span class="pre">row=vars(PAT_RACE_CAT)</span></code>, then this would stack the plots vertically. Note that we have to specify the variables inside the <code class="docutils literal notranslate"><span class="pre">vars()</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PAIN_INTENSITY_AVERAGE</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;Baseline&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">PAIN_INTENSITY_AVERAGE.FOLLOW_UP</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;Follow-Up&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;violetred&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pink&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Measurement&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Reported Pain Intensity&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Count&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="nf">vars</span><span class="p">(</span><span class="n">PAT_RACE_CAT</span><span class="p">))</span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“Removed 3604 rows containing non-finite values (`stat_bin()`).”
</pre></div>
</div>
<img alt="../_images/d02605f7b4aea35a221c583b58d5ed366cb71e5d66a93ccea64bd793f18ea815.png" src="../_images/d02605f7b4aea35a221c583b58d5ed366cb71e5d66a93ccea64bd793f18ea815.png" />
</div>
</div>
</section>
</section>
<section id="extra-options">
<h2>Extra Options<a class="headerlink" href="#extra-options" title="Permalink to this headline">#</a></h2>
<p>To create our final plot, we will demonstrate some extra features we haven’t covered so far. To create this plot, we first find the number of participants who selected each body region as well as the average pain intensity for those patients. We also classify each body part region into larger groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">pain_body_map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)[</span><span class="m">2</span><span class="o">:</span><span class="m">75</span><span class="p">])</span>
<span class="n">pain_body_map</span><span class="o">$</span><span class="n">num_patients</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">colSums</span><span class="p">(</span><span class="n">pain_df</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">75</span><span class="p">])</span>
<span class="n">pain_body_map</span><span class="o">$</span><span class="n">perc_patients</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pain_body_map</span><span class="o">$</span><span class="n">num_patients</span><span class="o">/</span><span class="nf">nrow</span><span class="p">(</span><span class="n">pain_df</span><span class="p">)</span>
<span class="n">pain_body_map</span><span class="o">$</span><span class="n">avg_pain</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">colSums</span><span class="p">(</span><span class="n">pain_df</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">75</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pain_df</span><span class="o">$</span><span class="n">PAIN_INTENSITY_AVERAGE</span><span class="p">)</span><span class="o">/</span><span class="n">pain_body_map</span><span class="o">$</span><span class="n">num_patients</span>
<span class="n">pain_body_map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pain_body_map</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">    </span><span class="nf">mutate</span><span class="p">(</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">case_when</span><span class="p">(</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X208&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X209&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X218&quot;</span><span class="p">,</span><span class="s">&quot;X219&quot;</span><span class="p">,</span><span class="s">&quot;X212&quot;</span><span class="p">,</span><span class="s">&quot;X213&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Back&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X105&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X106&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X205&quot;</span><span class="p">,</span><span class="s">&quot;X206&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Neck&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X107&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X110&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;X207&quot;</span><span class="p">,</span><span class="s">&quot;X210&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Shoulders&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X108&quot;</span><span class="p">,</span><span class="s">&quot;X109&quot;</span><span class="p">,</span><span class="s">&quot;X112&quot;</span><span class="p">,</span><span class="s">&quot;X113&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="s">&quot;Chest/Abs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X126&quot;</span><span class="p">,</span><span class="s">&quot;X127&quot;</span><span class="p">,</span><span class="s">&quot;X228&quot;</span><span class="p">,</span><span class="s">&quot;X229&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;X131&quot;</span><span class="p">,</span><span class="s">&quot;X132&quot;</span><span class="p">,</span><span class="s">&quot;X233&quot;</span><span class="p">,</span><span class="s">&quot;X234&quot;</span><span class="p">)</span><span class="o">~</span><span class="s">&quot;Legs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X111&quot;</span><span class="p">,</span><span class="s">&quot;X114&quot;</span><span class="p">,</span><span class="s">&quot;X211&quot;</span><span class="p">,</span><span class="s">&quot;X214&quot;</span><span class="p">,</span><span class="s">&quot;X115&quot;</span><span class="p">,</span><span class="s">&quot;X116&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;X117&quot;</span><span class="p">,</span><span class="s">&quot;X118&quot;</span><span class="p">,</span><span class="s">&quot;X217&quot;</span><span class="p">,</span><span class="s">&quot;X220&quot;</span><span class="p">)</span><span class="o">~</span><span class="s">&quot;Arms&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X119&quot;</span><span class="p">,</span><span class="s">&quot;X124&quot;</span><span class="p">,</span><span class="s">&quot;X221&quot;</span><span class="p">,</span><span class="s">&quot;X226&quot;</span><span class="p">,</span><span class="s">&quot;X125&quot;</span><span class="p">,</span><span class="s">&quot;X128&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;X227&quot;</span><span class="p">,</span><span class="s">&quot;X230&quot;</span><span class="p">)</span><span class="o">~</span><span class="s">&quot;Wrists/Hands&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X215&quot;</span><span class="p">,</span><span class="s">&quot;X216&quot;</span><span class="p">)</span><span class="o">~</span><span class="s">&quot;Elbows&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X135&quot;</span><span class="p">,</span><span class="s">&quot;X136&quot;</span><span class="p">,</span><span class="s">&quot;X237&quot;</span><span class="p">,</span><span class="s">&quot;X238&quot;</span><span class="p">,</span><span class="s">&quot;X133&quot;</span><span class="p">,</span><span class="s">&quot;X134&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;X235&quot;</span><span class="p">,</span><span class="s">&quot;X236&quot;</span><span class="p">)</span><span class="o">~</span><span class="s">&quot;Feet/Ankles&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X129&quot;</span><span class="p">,</span><span class="s">&quot;X130&quot;</span><span class="p">,</span><span class="s">&quot;X231&quot;</span><span class="p">,</span><span class="s">&quot;X232&quot;</span><span class="p">)</span><span class="o">~</span><span class="s">&quot;Knees&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X101&quot;</span><span class="p">,</span><span class="s">&quot;X102&quot;</span><span class="p">,</span><span class="s">&quot;X103&quot;</span><span class="p">,</span><span class="s">&quot;X104&quot;</span><span class="p">,</span><span class="s">&quot;X201&quot;</span><span class="p">,</span><span class="s">&quot;X203&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;X202&quot;</span><span class="p">,</span><span class="s">&quot;X204&quot;</span><span class="p">)</span><span class="o">~</span><span class="s">&quot;Head&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">part</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;X120&quot;</span><span class="p">,</span><span class="s">&quot;X121&quot;</span><span class="p">,</span><span class="s">&quot;X122&quot;</span><span class="p">,</span><span class="s">&quot;X123&quot;</span><span class="p">,</span><span class="s">&quot;X222&quot;</span><span class="p">,</span><span class="s">&quot;X223&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;X224&quot;</span><span class="p">,</span><span class="s">&quot;X225&quot;</span><span class="p">)</span><span class="o">~</span><span class="s">&quot;Hips&quot;</span><span class="p">))</span>
<span class="w">    </span>
<span class="nf">head</span><span class="p">(</span><span class="n">pain_body_map</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A data.frame: 6 × 5</caption>
<thead>
	<tr><th></th><th scope=col>part</th><th scope=col>num_patients</th><th scope=col>perc_patients</th><th scope=col>avg_pain</th><th scope=col>region</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>X101</td><td>323</td><td>0.0646</td><td>6.693498</td><td>Head</td></tr>
	<tr><th scope=row>2</th><td>X102</td><td>322</td><td>0.0644</td><td>6.819876</td><td>Head</td></tr>
	<tr><th scope=row>3</th><td>X103</td><td>165</td><td>0.0330</td><td>6.860606</td><td>Head</td></tr>
	<tr><th scope=row>4</th><td>X104</td><td>165</td><td>0.0330</td><td>6.951515</td><td>Head</td></tr>
	<tr><th scope=row>5</th><td>X105</td><td>493</td><td>0.0986</td><td>6.904665</td><td>Neck</td></tr>
	<tr><th scope=row>6</th><td>X106</td><td>507</td><td>0.1014</td><td>6.921105</td><td>Neck</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Within the theme we’ve chosen, we are able to update any of the <a class="reference external" href="https://ggplot2.tidyverse.org/reference/theme.html">theme options</a>. Below we use the <code class="docutils literal notranslate"><span class="pre">theme()</span></code> function to update the legend position to the bottom and the grid lines to light pink. Additionally, we add a horizontal line using the <code class="docutils literal notranslate"><span class="pre">geom_hline()</span></code> function (<code class="docutils literal notranslate"><span class="pre">geom_vline()</span></code> and <code class="docutils literal notranslate"><span class="pre">geom_abline()</span></code> can add vertical or diagonal lines respectively) and add a text annotation using the <code class="docutils literal notranslate"><span class="pre">annotate()</span></code> function. The resulting plot below shows the average pain value for each body part as well as the proportion of patients who categorized it as being painful.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_body_map</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_label</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">perc_patients</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">avg_pain</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="n">part</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">region</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">pain_body_map</span><span class="o">$</span><span class="n">avg_pain</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">annotate</span><span class="p">(</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Average Pain Value&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="m">0.35</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="m">7.0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Proportion Patients Selected Region&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Average Pain of Patients&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s">&quot;bottom&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_line</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lightpink&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a8295b30271a383e43d6d5e8d629e3cdf8bd3f0b744e860e7c18af9e743f7bc3.png" src="../_images/a8295b30271a383e43d6d5e8d629e3cdf8bd3f0b744e860e7c18af9e743f7bc3.png" />
</div>
</div>
<p>So far we have not saved any of our figures as objects. Below, I create two plots and save them as objects named <code class="docutils literal notranslate"><span class="pre">p1</span></code> and <code class="docutils literal notranslate"><span class="pre">p2</span></code>. If we want to save these plots, we can use the <code class="docutils literal notranslate"><span class="pre">ggsave()</span></code> function, which saves the last plot generated under the file name provided. Additionally, I can use the <code class="docutils literal notranslate"><span class="pre">patchwork</span></code> package to incorporate multiple plots together. A <code class="docutils literal notranslate"><span class="pre">+</span></code> between plots puts them side by side wheras <code class="docutils literal notranslate"><span class="pre">/</span></code> stacks them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">p1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_body_map</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_label</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">perc_patients</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">avg_pain</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="n">part</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">region</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="nf">mean</span><span class="p">(</span><span class="n">pain_body_map</span><span class="o">$</span><span class="n">avg_pain</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">annotate</span><span class="p">(</span><span class="n">geom</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s">&quot;Average Pain Value&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="m">0.35</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="m">7.0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Proportion Patients Selected Region&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Average Pain of Patients&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s">&quot;bottom&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_line</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lightpink&quot;</span><span class="p">))</span>

<span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">pain_body_map</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">perc_patients</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">&quot;violetred&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s">&quot;lightpink&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Proportion of Patients Selected Region&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">&quot;Count&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_line</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lightpink&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">p1</span><span class="o">/</span><span class="n">p2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div>
<img alt="../_images/a28a7a24871c86d75fd65ce7346fda747c630208a3f8900c4cdc3d33805b4bd6.png" src="../_images/a28a7a24871c86d75fd65ce7346fda747c630208a3f8900c4cdc3d33805b4bd6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggsave</span><span class="p">(</span><span class="s">&quot;images/myplot.png&quot;</span><span class="p">)</span><span class="w"> </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Saving 7 x 7 in image
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</pre></div>
</div>
</div>
</div>
</section>
<section id="recap-video">
<h2>Recap Video<a class="headerlink" href="#recap-video" title="Permalink to this headline">#</a></h2>
<div class="video-container">
    <iframe width="700" height="500" src="https://www.youtube.com/embed/0atAxk6Yk10" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
</div></section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">#</a></h2>
<p>For this chapter’s exercises, use the <code class="docutils literal notranslate"><span class="pre">covidcases</span></code> data set that we first introduced in <a class="reference external" href="https://alicepaul.github.io/r-for-health-data-science/book/5_data_transformations_summaries.html">Chapter 5</a> to recreate the plots below. These are complex plots, so try to build them up one step at a time and just try to get as close as possible to the given examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">data</span><span class="p">(</span><span class="n">covidcases</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">covidcases</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">week</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">weekly_cases</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_tile</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;white&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="m">9</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="c1">#scale_fill_gradientn(colours = cols,</span>
<span class="w">  </span><span class="c1">#                     limits = c(0, 1000),</span>
<span class="w">  </span><span class="c1">#                     na.value = &#39;white&#39;, name = &quot;Number of Cases&quot;, </span>
<span class="w">  </span><span class="c1">#                     breaks = seq(0, 1000, 50),</span>
<span class="w">  </span><span class="c1">#                     labels = c(&quot;0&quot;, &quot;&quot;, &quot;100&quot;, &quot;&quot;, &quot;200&quot;, &quot;&quot;, &quot;300&quot;, &quot;&quot;, &quot;400&quot;, &quot;&quot;, &quot;500&quot;, </span>
<span class="w">  </span><span class="c1">#                                &quot;&quot;, &quot;600&quot;, &quot;&quot;, &quot;700&quot;, &quot;&quot;, &quot;800&quot;, &quot;&quot;, &quot;900&quot;, &quot;&quot;, &quot;1000&quot;), </span>
<span class="w">  </span><span class="c1">#                     values=c(0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09, </span>
<span class="w">  </span><span class="c1">#                              0.1, .15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.5, 0.6, 0.7, 1),</span>
<span class="w">                       </span><span class="c1"># specify colors which change quickly at the beginning but slow down at the end</span>
<span class="w">  </span><span class="c1">#                     guide = guide_colourbar(ticks = T, nbin = 10, barheight = .5, label = T, barwidth = 15)) +</span>
<span class="w">  </span><span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">annotate</span><span class="p">(</span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">51</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Vaccine Introduced&quot;</span><span class="p">,</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-0.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_discrete</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;State&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">coord_equal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">expand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0.5</span><span class="p">),</span><span class="w"> </span><span class="n">breaks</span><span class="o">=</span><span class="nf">seq</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">35</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Week&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;bottom&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;bold&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span>
<span class="w">        </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;plain&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;plain&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="n">panel.grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&#39;United States COVID-19 Spread: Weekly Cases&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6665820546ac3a91985a77be9535f14dbf8f02a0cd699d9181b24d528eae0563.png" src="../_images/6665820546ac3a91985a77be9535f14dbf8f02a0cd699d9181b24d528eae0563.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">deaths</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">covidcases</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">summarize</span><span class="p">(</span><span class="n">deaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">weekly_cases</span><span class="p">))</span>

<span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">covidcases</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">totaldeaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">weekly_deaths</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">totaldeaths</span><span class="p">))</span>
<span class="n">top10states</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">state</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">])</span>

<span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">covidcases</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">top10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="n">state</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">top10states</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Other&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">top10</span><span class="p">,</span><span class="w"> </span><span class="n">week</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span>
<span class="w">  </span><span class="nf">summarise</span><span class="p">(</span><span class="n">totaldeaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">weekly_deaths</span><span class="p">))</span>
<span class="n">df</span><span class="o">$</span><span class="n">top10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">top10</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">top10states</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Other&quot;</span><span class="p">))</span>
<span class="n">df</span><span class="o">$</span><span class="n">date</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="m">2020</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">week</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;-&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;%Y-%U-%u&quot;</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">totaldeaths</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">top10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_area</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="m">1.0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="o">=</span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme_classic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_date</span><span class="p">(</span><span class="n">date_breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1 month&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s">&quot;bottom&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">axis.line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_line</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="m">0.8</span><span class="p">),</span>
<span class="w">        </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">),</span>
<span class="w">        </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span>
<span class="w">        </span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="n">face</span><span class="o">=</span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="n">face</span><span class="o">=</span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="n">axis.ticks.length</span><span class="o">=</span><span class="nf">unit</span><span class="p">(</span><span class="n">.</span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_line</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span>
<span class="w">      </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">&quot;bold&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w"> </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Stacked Area Chart for Total Deaths in the Top 10 States &quot;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Date&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Total Deaths&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;State&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>`summarise()` has grouped output by &#39;top10&#39;. You can override using the
`.groups` argument.
</pre></div>
</div>
<img alt="../_images/89bb65820dbed8b98c1071a07c655058eed93daa5589e906aaf729c886338a34.png" src="../_images/89bb65820dbed8b98c1071a07c655058eed93daa5589e906aaf729c886338a34.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./book"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="6_merging_data.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">6. Merging and Reshaping Data</p>
      </div>
    </a>
    <a class="right-next"
       href="8_distributions.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">8. Probability Distributions in R</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#intro-to-ggplot">Intro to ggplot</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#practice-question">Practice Question</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adjusting-the-axes-and-aesthetics">Adjusting the Axes and Aesthetics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-groups">Adding Groups</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Practice Question</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extra-options">Extra Options</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-video">Recap Video</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alice Paul
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>